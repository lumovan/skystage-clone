"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4427],{1608:function(t,e,i){i.d(e,{B:function(){return r}});var s=i(54539),o=i(30656),n=i(53161);async function r(t,e,i){let r=!1,a=null;try{a=(await s.g.currentAuthenticatedUser()).signInUserSession.idToken.jwtToken,r=!0}catch(t){r=!1}let l=r?n.Z.authenticated_send_compressed_formation_data:n.Z.send_compressed_formation_data;var h="";return h=void 0==i||null==i||""==i?"":i,await (0,o.Z)({method:"post",baseURL:"https://"+l+".execute-api.us-east-1.amazonaws.com/prod",...r&&{headers:{Authorization:a}},data:{formationUUID:t,offset:h,getDraftVersion:e?"true":"false"}})}},56412:function(t,e,i){var s=i(52676),o=i(62763),n=i.n(o),r=i(75271),a=i(59668),l=i.n(a),h=i(63408),m=i.n(h);class d extends r.Component{render(){return this.props.isLinkButton&&this.props.openInNewWindow?(0,s.jsx)(n(),{href:this.props.linkDestination,target:void 0==this.props.windowName?"_blank":this.props.windowName,children:(0,s.jsxs)("div",{className:l().standardCenteredDiv,style:{flexDirection:"row"},children:[this.props.hideArrow?null:(0,s.jsx)(m(),{src:"https://res.cloudinary.com/dgqeiqhlq/image/upload/v1709665559/left-facing-arrow-button_o5ltux.png",loader:()=>"https://res.cloudinary.com/dgqeiqhlq/image/upload/v1709665559/left-facing-arrow-button_o5ltux.png",width:16,height:16,onMouseOver:()=>{this.setState({isMouseOver:!0})},onMouseLeave:()=>{this.setState({isMouseOver:!1})},onClick:t=>{this.props.executeButtonClick(t)},style:{userSelect:"none",marginLeft:"2px",objectFit:"contain",transform:this.state.isMouseOver?"translateX(-5px)":"translateX(0px)",transition:"0.25s",cursor:"pointer",textAlign:"center"}}),(0,s.jsx)("div",{style:{width:"3.5px"}}),(0,s.jsx)("text",{onMouseOver:()=>{this.setState({isMouseOver:!0})},onMouseLeave:()=>{this.setState({isMouseOver:!1})},onClick:t=>{this.props.executeButtonClick(t)},style:{color:this.props.color?this.props.color:this.props.red?"#D24B4B":"#333",userSelect:"none",cursor:"pointer",letterSpacing:this.props.letterSpacing?this.props.letterSpacing:null,textAlign:"center",opacity:this.state.isMouseOver?.6:1,transition:".3s",fontFamily:"Work Sans",fontSize:"15px",fontWeight:"500",padding:"0px",color:"#333333"},children:this.props.buttonTitle})]})}):this.props.isLinkButton?(0,s.jsx)(n(),{href:this.props.linkDestination,children:(0,s.jsxs)("div",{className:l().standardCenteredDiv,style:{flexDirection:"row"},children:[this.props.hideArrow?null:(0,s.jsx)(m(),{src:"https://res.cloudinary.com/dgqeiqhlq/image/upload/v1709665559/left-facing-arrow-button_o5ltux.png",loader:()=>"https://res.cloudinary.com/dgqeiqhlq/image/upload/v1709665559/left-facing-arrow-button_o5ltux.png",width:16,height:16,onMouseOver:()=>{this.setState({isMouseOver:!0})},onMouseLeave:()=>{this.setState({isMouseOver:!1})},onClick:t=>{this.props.executeButtonClick(t)},style:{userSelect:"none",marginLeft:"2px",objectFit:"contain",transform:this.state.isMouseOver?"translateX(-5px)":"translateX(0px)",transition:"0.25s",cursor:"pointer",textAlign:"center"}}),(0,s.jsx)("div",{style:{width:"3.5px"}}),(0,s.jsx)("text",{onMouseOver:()=>{this.setState({isMouseOver:!0})},onMouseLeave:()=>{this.setState({isMouseOver:!1})},onClick:t=>{this.props.executeButtonClick(t)},style:{color:this.props.color?this.props.color:this.props.red?"#D24B4B":"#333",userSelect:"none",cursor:"pointer",letterSpacing:this.props.letterSpacing?this.props.letterSpacing:null,textAlign:"center",opacity:this.state.isMouseOver?.6:1,transition:".3s",fontFamily:"Work Sans",fontSize:"15px",fontWeight:"500",padding:"0px",color:"#333333"},children:this.props.buttonTitle})]})}):(0,s.jsxs)("div",{className:l().standardCenteredDiv,style:{flexDirection:"row"},children:[this.props.hideArrow?null:(0,s.jsx)(m(),{src:"https://res.cloudinary.com/dgqeiqhlq/image/upload/v1709665559/left-facing-arrow-button_o5ltux.png",loader:()=>"https://res.cloudinary.com/dgqeiqhlq/image/upload/v1709665559/left-facing-arrow-button_o5ltux.png",width:16,height:16,onMouseOver:()=>{this.setState({isMouseOver:!0})},onMouseLeave:()=>{this.setState({isMouseOver:!1})},onClick:t=>{this.props.executeButtonClick(t)},style:{userSelect:"none",marginLeft:"2px",objectFit:"contain",transform:this.state.isMouseOver?"translateX(-5px)":"translateX(0px)",transition:"0.25s",cursor:"pointer",textAlign:"center"}}),(0,s.jsx)("div",{style:{width:"3.5px"}}),(0,s.jsx)("text",{onMouseOver:()=>{this.setState({isMouseOver:!0})},onMouseLeave:()=>{this.setState({isMouseOver:!1})},onClick:t=>{this.props.executeButtonClick(t)},style:{color:this.props.color?this.props.color:this.props.red?"#D24B4B":"#333",userSelect:"none",cursor:"pointer",letterSpacing:this.props.letterSpacing?this.props.letterSpacing:null,textAlign:"center",opacity:this.state.isMouseOver?.6:1,transition:".3s",fontFamily:"Work Sans",fontSize:"15px",fontWeight:"500",padding:"0px",color:"#333333"},children:this.props.buttonTitle})]})}constructor(){super(),this.state={isMouseOver:!1}}}e.Z=d},11968:function(t,e,i){i.d(e,{F:function(){return h}});var s=i(94806);class o extends s.jyz{displayPointSelection(t){this.uniforms.useSelectionColor.value=t?1:0}setSize(t){this.uniforms.pointSize.value=t}constructor(){super({vertexShader:"\n      attribute float isSelected;\n      varying float vIsSelected;\n      varying vec3 vColor;\n      uniform float pointSize;\n\n      void main()\n      {\n        gl_Position = projectionMatrix * modelViewMatrix * instanceMatrix * vec4(position*pointSize, 1.0);\n        vIsSelected = isSelected;\n        vColor = vec3(0.0);\n\n        #ifdef USE_INSTANCING_COLOR\n          vColor = instanceColor;\n        #endif\n      }\n    ",fragmentShader:"\n      varying float vIsSelected;\n      varying vec3 vColor;\n      uniform float useSelectionColor;\n\n\n\n      vec3 hsv2rgb(vec3 hsv) {\n        float C = hsv.z * hsv.y; // Chroma\n        float X = C * (1.0 - abs(mod(hsv.x * 6.0, 2.0) - 1.0));\n        float m = hsv.z - C;\n\n        vec3 rgb;\n\n        if (hsv.x < 1.0 / 6.0) {\n            rgb = vec3(C, X, 0.0);\n        } else if (hsv.x < 2.0 / 6.0) {\n            rgb = vec3(X, C, 0.0);\n        } else if (hsv.x < 3.0 / 6.0) {\n            rgb = vec3(0.0, C, X);\n        } else if (hsv.x < 4.0 / 6.0) {\n            rgb = vec3(0.0, X, C);\n        } else if (hsv.x < 5.0 / 6.0) {\n            rgb = vec3(X, 0.0, C);\n        } else {\n            rgb = vec3(C, 0.0, X);\n        }\n\n        return rgb + m;\n      }\n\n      vec3 rgb2hsv(vec3 rgb) {\n        float Cmax = max(rgb.r, max(rgb.g, rgb.b));\n        float Cmin = min(rgb.r, min(rgb.g, rgb.b));\n        float delta = Cmax - Cmin;\n\n        float h = 0.0;\n        float s = 0.0;\n        float v = Cmax;\n\n        // Calculate hue\n        if (delta != 0.0) {\n            if (Cmax == rgb.r) {\n                h = mod((rgb.g - rgb.b) / delta, 6.0);\n            } else if (Cmax == rgb.g) {\n                h = (rgb.b - rgb.r) / delta + 2.0;\n            } else {\n                h = (rgb.r - rgb.g) / delta + 4.0;\n            }\n            h /= 6.0; // Normalize to [0, 1]\n            if (h < 0.0) h += 1.0;\n        }\n\n        // Calculate saturation\n        if (Cmax != 0.0) {\n            s = delta / Cmax;\n        }\n\n        return vec3(h, s, v);\n      }\n\n\n      void main()\n      {\n        vec3 col = rgb2hsv(vColor);\n        // col.g = mix(col.g * 0.8, col.g, vIsSelected);\n        col.b = mix(col.b, 0.5, useSelectionColor);\n        \n        vec3 selectionColor = hsv2rgb(col);\n        gl_FragColor = vec4(vColor, 1.0);\n        // gl_FragColor = vec4(mix(vColor, selectionColor, useSelectionColor), 1.0);\n        #include <colorspace_fragment>\n      }\n    ",uniforms:{useSelectionColor:{value:0},pointSize:{value:1}}})}}var n=i(27236),r=i(50017);function a(){return new Worker(i.p+"static/bcb8c8e46e507a7b.worker.js")}var l=i(94381);class h extends s.SPe{setAnimationData(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,m=arguments.length>10?arguments[10]:void 0;this.showBoxSize=i,this.rawFrames=[],this.frameColors=[];let d=Object.values(t);this.droneCount=d[0].coordinatesArray.length/3,this.droneCountWithoutExtraDrones=this.droneCount;for(let t=0;t<d.length;t++)this.rawFrames.push(d[t].coordinatesArray),this.frameColors.push(d[t].colorsArray);for(let t=0;t<this.frameColors.length;t++){let e=this.frameColors[t];for(let t=0;t<e.length;t++){let i=e[t];i.startsWith("#")&&(e[t]=i.substring(1)),i.length>6&&(e[t]=i.substring(1))}}this.setFormationSize(e),this.setFormationOffset(new s.Vector3(o,n,r)),this.setShowOffset(new s.Vector3(a,l,h)),this.computeBoundingBox(),m&&(this.extra_drone_data={drone_count:m.drone_count,color:m.color,side:m.side,grid_spacing:m.grid_spacing,grid_columns:m.grid_columns},this.initialize_extra_drones()),this.initialize_drone_offsets(),this.computeMetricsAsync()}getFrameData(t,e){if(!this.rawFrames||0===this.rawFrames.length)return console.warn("getFrameData: No rawFrames available"),[];let i=this.rawFrames.length-1,o=Math.floor(t*i),n=o+1;o===i&&(n=e?o:0);let r=t*i-o,a=this.rawFrames[o],l=this.rawFrames[n],h=this.frameColors[o]||[],m=this.frameColors[n]||[];if(!a||!l)return console.warn("getFrameData: Missing coordinate data for frames",o,n),[];let d=[],c=this.getDroneCount();for(let t=0;t<c;t++){let e=3*t,i=a[e],o=a[e+1],n=a[e+2],c=l[e],u=l[e+1],f=l[e+2],p=i+(c-i)*r,g=o+(u-o)*r,x=n+(f-n)*r,F=new s.Ilk("#"+h[t]),w=new s.Ilk("#"+m[t]),_=F.clone().lerp(w,r);d.push({position:new s.Vector3(p,g,x),color:_,scale:new s.Vector3(1,1,1),isSelectable:!0})}return d}setNormalizedTime(t,e){let i=this.getFrameData(t,e),o=new s.yGw;for(let t=0;t<i.length;t++){let e=i[t].position.clone().multiply(this.position_scale).add(this.position_offset);e.set(e.x,e.z,-1*e.y),e.add(this.drone_offsets[t]),o.compose(e,new s._fP,i[t].scale),this.setMatrixAt(t,o),this.setColorAt(t,i[t].color)}this.instanceMatrix.needsUpdate=!0,this.instanceColor.needsUpdate=!0,this.count=i.length,this.material.setSize(l.Z.particle_size)}displayPointSelection(t){this.material.displayPointSelection(t)}setPointAsSelected(t){this.geometry.attributes.isSelected.setX(t,1)}updateSelectionArray(){this.geometry.attributes.isSelected.needsUpdate=!0}clearSelection(){for(let t=0;t<this.geometry.attributes.isSelected.count;t++)this.geometry.attributes.isSelected.array[t]=0;this.updateSelectionArray()}setTime(t){this.setNormalizedTime(t/this.getAnimationLength()%1)}getAnimationLength(){return this.rawFrames.length/this.fps}getWorldPositionFrameData(t,e){return this.getFrameData(t,e).map(t=>({position:t.position.clone().multiply(this.position_scale).add(this.position_offset),color:t.color.clone(),scale:t.scale.clone(),isSelectable:t.isSelectable}))}isDroneSelectable(t){return t<this.droneCountWithoutExtraDrones}dispose(){this.geometry.dispose(),this.material.dispose()}async applyEffects(){this.restoreOriginalAnimation();let t=this.get_effects();for(let e=0;e<t.length;e++){let i=t[e];i.applyTo&&"AsyncFunction"===i.applyTo.constructor.name?(console.log("Applying async effect: ".concat(i.name||i.constructor.name)),await i.applyTo(this)):i.applyTo(this)}this.setExtraDronesPosition()}async add_effect(t){this.effects.push(t),await this.applyEffects()}get_effects(){return this.sort_effects([...this.effects])}sort_effects(t){let e=t.sort((t,e)=>t.created_at-e.created_at),i=[],s=0;for(;s<e.length;)e[s].name===new r.a().name||e[s].name===new n.f().name?(i.push(e[s]),e.splice(s,1)):s++;for(let t=0;t<i.length;t++)e.unshift(i[t]);return e}async remove_effect_by_id(t){let e=this.effects.find(e=>e.uuid===t);if(e){let t=this.effects.indexOf(e);this.effects.splice(t,1),await this.applyEffects()}}async remove_effect(t){let e=this.effects.find(e=>e.name===t);if(e){let t=this.effects.indexOf(e);this.effects.splice(t,1),await this.applyEffects()}}remove_time_override_effects(){this.remove_effect(new r.a().name),this.remove_effect(new n.f().name)}export(){let t={};for(let e=0;e<this.animationFrames.length;e++){let i={frame_number:e,coordinates:[]},s=this.animationFrames[e];for(let t=0;t<s.length;t++){let e=s[t];e.isSelectable&&i.coordinates.push({x:e.position.x,y:e.position.y,z:e.position.z,color:e.color.getHexString(),drone_in_formation_id:t})}t[e]=i}return t}getClampedFrameAt(t,e){return t<e.length?e[t]:e[e.length-1]}computeMinimumProximityDistance(){if(!this.rawFrames||0===this.rawFrames.length){this.minimumProximityDistance=0;return}let t=1e3,e=this.droneCount-this.extra_drone_data.drone_count;if(e<=1){this.minimumProximityDistance=this.formationSize/1e3*1e3;return}if(e<=10){for(let i=0;i<this.rawFrames.length;i++){let s=this.rawFrames[i],o=1/0;for(let t=0;t<e;t++){let i=3*t;for(let n=t+1;n<e;n++){let t=3*n,e=s[t]-s[i],r=s[t+1]-s[i+1],a=s[t+2]-s[i+2];o=Math.min(o,Math.sqrt(e*e+r*r+a*a))}}o!==1/0&&(t=Math.min(t,o))}this.minimumProximityDistance=this.formationSize/1e3*t;return}for(let i=0;i<this.rawFrames.length;i++){let s=this.rawFrames[i],o=1/0,n=1/0,r=1/0,a=-1/0,l=-1/0,h=-1/0,m=Array(e);for(let t=0;t<e;t++){let e=3*t,i=s[e],d=s[e+1],c=s[e+2];m[t]={index:t,x:i,y:d,z:c},o=Math.min(o,i),n=Math.min(n,d),r=Math.min(r,c),a=Math.max(a,i),l=Math.max(l,d),h=Math.max(h,c)}m.sort((t,e)=>t.x-e.x);let d=1/0,c=.99*t;for(let e=0;e<m.length;e++){let i=m[e];for(let s=e+1;s<m.length&&m[s].x-i.x<d;s++){let e=m[s];if(Math.abs(e.y-i.y)>=d||Math.abs(e.z-i.z)>=d)continue;let o=e.x-i.x,n=e.y-i.y,r=e.z-i.z;if((d=Math.min(d,Math.sqrt(o*o+n*n+r*r)))<c){t=d;break}}if(d<c)break}d!==1/0&&(t=Math.min(t,d))}this.minimumProximityDistance=this.formationSize/1e3*t}computeMaximumDroneSpeed(){if(!this.rawFrames||this.rawFrames.length<=1){this.maximumSpeed=0;return}let t=this.droneCount-this.extra_drone_data.drone_count,e=this.rawFrames.length,i=this.getAnimationLength(),s=i&&i>0?e/i:24,o=this.formationSize/1e3*s;i&&Math.abs(s-24)>.1&&console.log("Sync speed calculation fix: ".concat(e," frames over ").concat(i,"s = ").concat(s.toFixed(2)," FPS (was using 24 FPS)"));let n=0;for(let i=0;i<e-1;i++){let e=this.rawFrames[i],s=this.rawFrames[i+1];for(let i=0;i<t;i++){let t=3*i,o=e[t],r=e[t+1],a=e[t+2],l=s[t],h=s[t+1],m=s[t+2],d=l-o,c=h-r,u=m-a;n=Math.max(n,d*d+c*c+u*u)}}this.maximumSpeed=Math.sqrt(n)*o}shiftAnimationTime(t){let e=this.getAnimationLength()+t,i=Math.floor(this.fps*e);if(!this.rawFrames||0===this.rawFrames.length)return;if(i<0){console.warn("shiftAnimationTime: Invalid frame count ".concat(i,", cannot be negative. Skipping adjustment."));return}if(i>1e6){console.warn("shiftAnimationTime: Frame count ".concat(i," is too large, skipping adjustment."));return}let s=this.rawFrames.length;if(i!==s){if(i<s)try{this.rawFrames.length=i,this.frameColors.length=i,this.computeMetricsAsync();return}catch(t){console.error("Error setting array length to ".concat(i,":"),t);return}if(i>s){let t=this.rawFrames[s-1],e=this.frameColors[s-1]||[],o=i-s;for(let i=0;i<o;i++)this.rawFrames.push(Float32Array.from(t)),this.frameColors.push([...e])}}}setFormationSize(t){this.formationSize=t;let e=this.formationSize/1e3;this.position_scale.set(e,e,-e),this.updatePositionOffset(),this.computeMetricsAsync()}setFormationOffset(t){this.formation_offset.copy(t),this.updatePositionOffset()}setShowOffset(t){this.show_offset.copy(t),this.updatePositionOffset()}updatePositionOffset(){let t=this.showBoxSize;var e=this.formation_offset.x,i=this.formation_offset.y+(t-this.formationSize)/2-t/2,s=this.formation_offset.z+(t-this.formationSize)/2+t;this.position_offset.set(e,i,s),this.position_offset.add(this.show_offset)}setExtraDronesColor(t){let e=this.extra_drone_data.drone_count,i=this.droneCount-e,s=t.replace("#","");for(let t=0;t<this.frameColors.length;t++){let o=this.frameColors[t];for(let t=0;t<e;t++){let e=i+t;e<o.length&&(o[e]=s)}}}initialize_extra_drones(){let t=this.extra_drone_data.drone_count;if(t<=0)return;let e=this.extra_drone_data.color,i=this.extra_drone_data.side,s=this.droneCount;this.droneCount=this.droneCount+t;for(let i=0;i<this.rawFrames.length;i++){let o=this.rawFrames[i],n=this.frameColors[i]||[],r=new Float32Array(3*this.droneCount),a=Array(this.droneCount);r.set(o);for(let t=0;t<s;t++)a[t]=n[t]||"#FFFFFF";for(let i=0;i<t;i++){let t=(s+i)*3;r[t]=0,r[t+1]=0,r[t+2]=0,a[s+i]=e.replace("#","")}this.rawFrames[i]=r,this.frameColors[i]=a}this.setExtraDronesPosition(i)}updateExtraDronesPosition(){this.setExtraDronesPosition(this.extra_drone_data.side)}setExtraDronesPosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"behind";if(!this.extra_drone_data||this.extra_drone_data.drone_count<=0)return;this.extra_drone_data.side=t;let e=this.extra_drone_data.drone_count,i=this.extra_drone_data.side,o=this.extra_drone_data.grid_spacing,n=1e3/this.formationSize*o,r=this.boundingBox.clone(),a=new s.Vector3;r.getSize(a);let l=[],h="behind"===i?r.min.x-n:r.max.x+n,m=r.min.y+(r.max.y-r.min.y)/2,d=0;d=e<30?r.min.z+a.z/2:e>=30&&e<=50?r.min.z+a.z/4:r.min.z;for(let t=0;t<e;t++){let e=m;switch(t%4){case 0:e=m;break;case 1:e=m+n;break;case 2:e=m-n;break;case 3:e=m+2*n}let i=d+Math.floor(t/4)*n;l.push(new s.Vector3(h,e,i))}let c=this.droneCount-e;if(this.rawFrames&&this.rawFrames.length>0)for(let t=0;t<this.rawFrames.length;t++){let i=this.rawFrames[t];for(let t=0;t<e;t++){let e=3*(c+t),s=l[t];i[e]=s.x,i[e+1]=s.y,i[e+2]=s.z}}this.computeBoundingBox()}getRawBoundingBox(){return this.boundingBox.clone()}computeBoundingBox(){let t=this.droneCount-this.extra_drone_data.drone_count,e=new s.ZzF,i=new s.ZzF,o=new s.ZzF,n=new s.Vector3;for(let s=0;s<this.rawFrames.length;s++){let r=this.rawFrames[s];for(let s=0;s<t;s++){let t=r[3*s+0],a=r[3*s+1],l=r[3*s+2];n.set(t,a,l),e.expandByPoint(n),n.multiply(this.position_scale).add(this.position_offset),i.expandByPoint(n),n.set(n.x,n.z,-1*n.y),o.expandByPoint(n)}}this.boundingBox.copy(e),this.worldBoundingBox.copy(i),this.visualBoundingBox.copy(o)}mergeWith(t,e){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],o=this.clone(),n=t.clone();if(!o.rawFrames||0===o.rawFrames.length)throw console.error("First formation missing Float32Array data:",o),Error("First formation missing Float32Array data");if(!n.rawFrames||0===n.rawFrames.length)throw console.error("Second formation missing Float32Array data:",n),Error("Second formation missing Float32Array data");let r=Math.max(o.rawFrames.length,n.rawFrames.length);o.rawFrames.length<r&&o.extend_frames(r-o.rawFrames.length),n.rawFrames.length<r&&n.extend_frames(r-n.rawFrames.length);let a=o.droneCount-o.extra_drone_data.drone_count,l=n.droneCount-n.extra_drone_data.drone_count,m=new s.Vector3;o.boundingBox.getSize(m);let d=new s.Vector3;n.boundingBox.getSize(d);let c=[],u=[];for(let t=0;t<r;t++){let e=new Float32Array((a+l)*3),i=Array(a+l),s=o.rawFrames[t];for(let n=0;n<a;n++){let r=3*n,a=3*n;e[a]=s[r],e[a+1]=s[r+1],e[a+2]=s[r+2],i[n]=o.frameColors[t]&&o.frameColors[t][n]?o.frameColors[t][n]:"FFFFFF"}let r=n.rawFrames[t];for(let s=0;s<l;s++){let l=3*s,h=(a+s)*3,c=r[l],u=r[l+1],f=r[l+2];c=c*n.position_scale.x+n.position_offset.x,u=u*n.position_scale.y+n.position_offset.y,f=f*n.position_scale.z+n.position_offset.z,c=(c-o.position_offset.x)/o.position_scale.x,u=(u-o.position_offset.y)/o.position_scale.y,f=(f-o.position_offset.z)/o.position_scale.z,u+=m.y/2+d.y/2,e[h]=c,e[h+1]=u,e[h+2]=f,i[a+s]=n.frameColors[t]&&n.frameColors[t][s]?n.frameColors[t][s]:"FFFFFF"}c.push({coordinatesArray:e,droneCount:a+l}),u.push(i)}let f={};for(let t=0;t<c.length;t++)f[t]={coordinatesArray:c[t].coordinatesArray,colorsArray:u[t],droneCount:a+l};let p={drone_count:Math.max(0,this.droneCount-a-l),color:this.extra_drone_data.color,side:this.extra_drone_data.side,grid_spacing:this.extra_drone_data.grid_spacing,grid_columns:this.extra_drone_data.grid_columns},g=new h,x=a+l;g.setAnimationData(f,!1,this.formationSize,this.showBoxSize,0,0,0,this.show_offset.x,this.show_offset.y,this.show_offset.z,p,x),g.droneCountWithoutExtraDrones=x;let F=g.getAnimationLength();if(Math.abs(F-e)>.1&&g.shiftAnimationTime(e-F),!i)return g;this.rawFrames=g.rawFrames,this.frameColors=g.frameColors,this.droneCount=g.droneCount,this.droneCountWithoutExtraDrones=g.droneCountWithoutExtraDrones,this.animationFrames=g.animationFrames,this.originalAnimationFrames=g.originalAnimationFrames,this.extra_drone_data=g.extra_drone_data,this.position_offset=g.position_offset,this.position_scale=g.position_scale,this.formation_offset=g.formation_offset,this.formationSize=g.formationSize,this.showBoxSize=g.showBoxSize,this.minimumProximityDistance=g.minimumProximityDistance,this.maximumSpeed=g.maximumSpeed,this.boundingBox.copy(g.boundingBox),this.visualBoundingBox.copy(g.visualBoundingBox),this.initialize_drone_offsets()}getExtraDroneCount(){return this.extra_drone_data.drone_count}getSelectableDroneCount(){return this.getDroneCount()-this.getExtraDroneCount()}getDroneCount(){return this.rawFrames&&0!==this.rawFrames.length&&this.rawFrames[0]?this.rawFrames[0].length/3:(console.warn("getDroneCount: rawFrames is empty or undefined, returning droneCount property or 0"),this.droneCount||0)}clone(){let t=new h;if(this.rawFrames&&this.rawFrames.length>0&&this.droneCount>0){if(t.rawFrames=this.rawFrames.map(t=>{let e=new Float32Array(t.length);return e.set(t),e}),t.frameColors=this.frameColors.map(t=>t?[...t]:[]),t.droneCount=this.droneCount,this.animationFrames&&this.animationFrames.length>0){t.animationFrames=[],t.originalAnimationFrames=[];for(let e=0;e<this.animationFrames.length;e++){let i=this.animationFrames[e],s=this.originalAnimationFrames[e],o=[],n=[];for(let t=0;t<i.length;t++)o.push({position:i[t].position.clone(),color:i[t].color.clone(),scale:i[t].scale.clone(),isSelectable:i[t].isSelectable}),n.push({position:s[t].position.clone(),color:s[t].color.clone(),scale:s[t].scale.clone(),isSelectable:s[t].isSelectable});t.animationFrames.push(o),t.originalAnimationFrames.push(n)}}}else{let e=[];for(let t=0;t<this.animationFrames.length;t++){let i=this.animationFrames[t],s=[];for(let t=0;t<i.length;t++)i[t].isSelectable&&s.push({x:i[t].position.x,y:i[t].position.y,z:i[t].position.z,color:"#"+i[t].color.getHexString()});e.push(s)}return t.setAnimationData(e,!1,this.formationSize,this.showBoxSize,this.formation_offset.x,this.formation_offset.y,this.formation_offset.z,void 0,void 0,void 0,this.extra_drone_data),t}return t.name=this.name,t.formationSize=this.formationSize,t.showBoxSize=this.showBoxSize,t.formation_offset=this.formation_offset.clone(),t.position_offset=this.position_offset.clone(),t.position_scale=this.position_scale.clone(),t.show_offset=this.show_offset.clone(),t.extra_drone_data={drone_count:this.extra_drone_data.drone_count,color:this.extra_drone_data.color,side:this.extra_drone_data.side,grid_spacing:this.extra_drone_data.grid_spacing,grid_columns:this.extra_drone_data.grid_columns},this.boundingBox&&(t.boundingBox=this.boundingBox.clone()),this.visualBoundingBox&&(t.visualBoundingBox=this.visualBoundingBox.clone()),t.fps=this.fps,t.minimumProximityDistance=this.minimumProximityDistance,t.maximumSpeed=this.maximumSpeed,t}initialize_drone_offsets(){if(this.drone_offsets.length=0,!this.rawFrames||0===this.rawFrames.length||!this.rawFrames[0]){console.warn("initialize_drone_offsets: No rawFrames available, using droneCount or 0");let t=this.droneCount||0;for(let e=0;e<t;e++)this.drone_offsets.push(new s.Vector3);return}for(let t=0;t<this.rawFrames[0].length/3;t++)this.drone_offsets.push(new s.Vector3)}set_drone_offsets(t,e){for(let i=0;i<e.length;i++)this.drone_offsets[e[i]].copy(t[i])}apply_drone_offsets(){let t=this.getDroneCount(),e=new Float32Array(3*t);for(let i=0;i<t;i++){let t=this.drone_offsets[i],s=3*i;e[s]=t.x/this.position_scale.x,e[s+1]=-t.z/this.position_scale.y,e[s+2]=t.y/this.position_scale.z}let i=this.rawFrames.length;for(let s=0;s<i;s++){let i=this.rawFrames[s];for(let s=0;s<t;s++)i[3*s+0]+=e[3*s+0],i[3*s+1]+=e[3*s+1],i[3*s+2]+=e[3*s+2]}for(let t=0;t<this.drone_offsets.length;t++)this.drone_offsets[t]&&this.drone_offsets[t].set(0,0,0);this.updateExtraDronesPosition(),this.computeMetricsAsync()}reset_drone_offsets(){for(let t=0;t<this.drone_offsets.length;t++)this.drone_offsets[t].set(0,0,0)}get_drone_offset(t){return this.drone_offsets[t]}get_drone_live_position(t){let e=new s.yGw;e.elements[0]=this.instanceMatrix.getComponent(t,0),e.elements[1]=this.instanceMatrix.getComponent(t,1),e.elements[2]=this.instanceMatrix.getComponent(t,2),e.elements[3]=this.instanceMatrix.getComponent(t,3),e.elements[4]=this.instanceMatrix.getComponent(t,4),e.elements[5]=this.instanceMatrix.getComponent(t,5),e.elements[6]=this.instanceMatrix.getComponent(t,6),e.elements[7]=this.instanceMatrix.getComponent(t,7),e.elements[8]=this.instanceMatrix.getComponent(t,8),e.elements[9]=this.instanceMatrix.getComponent(t,9),e.elements[10]=this.instanceMatrix.getComponent(t,10),e.elements[11]=this.instanceMatrix.getComponent(t,11),e.elements[12]=this.instanceMatrix.getComponent(t,12),e.elements[13]=this.instanceMatrix.getComponent(t,13),e.elements[14]=this.instanceMatrix.getComponent(t,14),e.elements[15]=this.instanceMatrix.getComponent(t,15);let i=new s.Vector3,o=new s._fP,n=new s.Vector3;return e.decompose(i,o,n),i}extend_frames(t){if(!(t<=0)){if(this.rawFrames&&this.rawFrames.length>0){let e=this.rawFrames.length-1,i=this.rawFrames[e],s=this.frameColors[e];for(let e=0;e<t;e++){let t=new Float32Array(i.length);t.set(i);let e=Array.from(s);this.rawFrames.push(t),this.frameColors.push(e)}}console.log("COLORS AFTER EXTENSION",this.frameColors)}}delete_drones(t){let e=t.sort((t,e)=>e-t);for(let t=0;t<e.length;t++)this.delete_drone(e[t]);this.computeBoundingBox(),this.setExtraDronesPosition(),this.computeMetricsAsync()}delete_drone(t){let e=this.extra_drone_data.drone_count,i=this.droneCount-e-1;if(this.rawFrames&&this.rawFrames.length>0)for(let e=0;e<this.rawFrames.length;e++){let s=this.rawFrames[e],o=this.frameColors[e],n=3*i,r=3*t;t<i&&(s[r]=s[n],s[r+1]=s[n+1],s[r+2]=s[n+2],o&&(o[t]=o[i])),o&&(o[i]=this.extra_drone_data.color.replace("#",""))}this.extra_drone_data.drone_count++,this.droneCountWithoutExtraDrones--}delete_drone_at_frame(t,e,i){let s=3*i,o=3*e;t[o]=t[s],t[o+1]=t[s+1],t[o+2]=t[s+2]}computeMetricsAsync(){if(!this.rawFrames||0===this.rawFrames.length){console.warn("computeMetricsAsync: No raw frames available for metrics computation"),this.minimumProximityDistance=0,this.maximumSpeed=0,this.maxUpSpeed=0,this.maxDownSpeed=0,this.maxHorizontalSpeed=0,this.maxForwardSpeed=0,this.maxBackwardSpeed=0;return}if(!this.metricsWorker){console.warn("computeMetricsAsync: No metrics worker available");return}this.minimumProximityDistance=-100,this.maximumSpeed=-100,this.maxUpSpeed=-100,this.maxDownSpeed=-100,this.maxHorizontalSpeed=-100,this.maxForwardSpeed=-100,this.maxBackwardSpeed=-100;let t={type:"computeMetrics",rawFrames:this.rawFrames,droneCount:this.droneCount,extraDroneCount:this.extra_drone_data.drone_count,formationSize:this.formationSize,animationLength:this.getAnimationLength()};this.metricsWorker.postMessage(t)}handleMetricsResult(t){let{proximityDistance:e,maxSpeed:i,granularSpeeds:s}=t.data;this.minimumProximityDistance=e,this.maximumSpeed=i,s&&(this.maxUpSpeed=s.maxUpSpeed,this.maxDownSpeed=s.maxDownSpeed,this.maxHorizontalSpeed=s.maxHorizontalSpeed,this.maxForwardSpeed=s.maxForwardSpeed,this.maxBackwardSpeed=s.maxBackwardSpeed)}storeOriginalData(){if(this.hasStoredOriginalData){console.warn("Original data already stored");return}if(!this.rawFrames||0===this.rawFrames.length){console.warn("No formation data to store");return}let t=[];for(let e=0;e<this.frameColors.length;e++){let i=[];for(let t=0;t<this.getDroneCount();t++)i.push(this.frameColors[e][t]);t.push(i)}this.originalData={rawFrames:this.rawFrames.map(t=>new Float32Array(t)),frameColors:t,droneCount:this.droneCount,droneCountWithoutExtraDrones:this.droneCountWithoutExtraDrones,formationSize:this.formationSize,extra_drone_data:{...this.extra_drone_data}},this.hasStoredOriginalData=!0}restoreOriginalAnimation(){if(!this.hasStoredOriginalData||!this.originalData){console.warn("No stored original data to restore");return}let t=[],e=this.originalData.frameColors[0].length;for(let i=0;i<this.originalData.frameColors.length;i++){let s=[];for(let t=0;t<e;t++)s.push(this.originalData.frameColors[i][t]);t.push(s)}this.rawFrames=this.originalData.rawFrames.map(t=>new Float32Array(t)),this.frameColors=t,this.droneCount=this.originalData.droneCount,this.droneCountWithoutExtraDrones=this.originalData.droneCountWithoutExtraDrones,this.formationSize=this.originalData.formationSize,this.extra_drone_data={...this.originalData.extra_drone_data},this.computeBoundingBox(),this.computeMetricsAsync()}clearOriginalDataStore(){if(!this.hasStoredOriginalData){console.warn("No stored data to clear");return}this.originalData=null,this.hasStoredOriginalData=!1,console.log("Original formation data cleared from memory")}convert_local_to_visual(t){return t.multiply(this.position_scale).add(this.position_offset),t.set(t.x,t.z,-1*t.y),t}convert_visual_to_local(t){return t.set(t.x,-1*t.z,t.y),t.sub(this.position_offset),t.divide(this.position_scale),t}convert_visual_to_local_direction(t){return t.set(t.x,-1*t.z,t.y),t.divide(this.position_scale),t}convert_local_to_visual_direction(t){return t.multiply(this.position_scale),t.set(t.x,t.z,-1*t.y),t}convert_local_to_world(t){return t.multiply(this.position_scale).add(this.position_offset),t}convert_world_to_visual(t){return t.set(t.x,t.z,-1*t.y),t}convert_visual_to_world(t){return t.set(t.x,-1*t.z,t.y),t}convert_visual_to_world_direction(t){return t.set(t.x,-1*t.z,t.y),t}convert_visual_to_world_scale(t){return t.set(t.x,t.z,t.y),t}apply_rotation(t,e,i){let o=new s._fP().setFromAxisAngle(new s.Vector3(0,1,0),-Math.PI/2),n=new s.yGw().set(1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1),r=new s.yGw().makeRotationFromQuaternion(o);r.premultiply(n),r.multiply(n.clone().invert());let a=new s._fP().setFromRotationMatrix(r),l=new s.Vector3;this.visualBoundingBox.getCenter(l),l.set(l.x,-1*l.z,l.y),l.sub(this.position_offset),l.divide(this.position_scale);let h=this.rawFrames,m=this.getDroneCount(),d=new s.Vector3;for(let t=0;t<h.length;t++){let e=h[t];for(let t=0;t<m;t++)d.x=e[3*t+0],d.y=e[3*t+1],d.z=e[3*t+2],d.sub(l),d.applyQuaternion(a),d.add(l),e[3*t+0]=d.x,e[3*t+1]=d.y,e[3*t+2]=d.z}}recompute_extra_drones(){this.computeBoundingBox(),this.updateExtraDronesPosition(),this.computeMetricsAsync()}constructor(){super(new s.xo$(1),new o,1e4),this.isTransition=!1,this.geometry.setAttribute("isSelected",new s.lb7(new Float32Array(1e4),1,!1));for(let t=0;t<this.geometry.attributes.isSelected.count;t++)this.geometry.attributes.isSelected.array[t]=0;this.count=0,this.boundingBox=new s.ZzF,this.worldBoundingBox=new s.ZzF,this.visualBoundingBox=new s.ZzF,this.originalAnimationFrames=[],this.animationFrames=[],this.rawFrames=[],this.layers.enable(5),this.fps=24,this.position_offset=new s.Vector3(0,0,0),this.position_scale=new s.Vector3(1,1,1),this.formation_offset=new s.Vector3(0,0,0),this.show_offset=new s.Vector3(0,0,0),this.frustumCulled=!1,this.effects=[],this.formationSize=1,this.showBoxSize=100,this.minimumProximityDistance=1,this.maximumSpeed=-1,this.maxUpSpeed=-1,this.maxDownSpeed=-1,this.maxHorizontalSpeed=-1,this.maxForwardSpeed=-1,this.maxBackwardSpeed=-1,this.extra_drone_data={drone_count:0,color:"#FF0000",side:"behind",grid_spacing:5,grid_columns:4},this.drone_offsets=[];try{this.metricsWorker=new a,this.metricsWorker.onmessage=this.handleMetricsResult.bind(this),this.metricsWorker.onerror=t=>{console.error("Metrics Worker error:",t)}}catch(t){console.error("Failed to initialize Metrics Worker:",t),this.metricsWorker=null}this.hasStoredOriginalData=!1,this.originalData=null}}},30966:function(t,e,i){i.d(e,{q:function(){return n}});var s=i(94806),o=i(57851);class n extends s.Tme{constructor(){super(),this.position.set(75,-60,0).multiplyScalar(2),this.add(new s.Mig(void 0,1)),new o.E().load("models/environment_0.glb",t=>{let e=t.scene;this.add(e),e.traverse(t=>{t.material&&(t.material=new s.vBJ({map:t.material.map,transparent:t.material.transparent,alphaTest:t.material.alphaTest}),"ground"===t.name&&t.layers.enable(3))})}),this.camera=new s.cPb(30,1,.1,1e3)}}},60826:function(t,e,i){i.d(e,{Z:function(){return f}});var s=i(94806),o=i(11968);class n{static generateInterpolatedFramesOverTime(t,e,i,s){let o=Math.ceil(i*s),n=t.length,r=[],a=[];for(let i=0;i<o;i++){let s=i/(o-1),l=new Float32Array(3*n),h=Array(n);for(let i=0;i<n;i++){let o=3*i,n=t[i].position,r=e[i].position;l[o]=n.x+(r.x-n.x)*s,l[o+1]=n.y+(r.y-n.y)*s,l[o+2]=n.z+(r.z-n.z)*s;let a=t[i].color,m=e[i].color,d=a.clone().lerp(m,s);h[i]=d.getHexString()}r.push(l),a.push(h)}return{rawFrames:r,frameColors:a}}constructor(){}}class r extends o.F{createFrameObjectsFromRawData(t,e,i){if(!t)return console.error("No coordinate data provided for frame conversion"),[];let o=Array(i),n=Math.min(i,Math.floor(t.length/3)),r=new s.Vector3,a=new s.Vector3(1,1,1);for(let i=0;i<n;i++){let n=3*i;r.set(t[n],t[n+1],t[n+2]);let l=e&&e[i]?e[i]:"FFFFFF",h=l.startsWith("#")?l:"#".concat(l);o[i]={position:r.clone(),color:new s.Ilk(h),scale:a.clone(),isSelectable:!0}}for(let t=n;t<i;t++)o[t]={position:new s.Vector3(0,0,0),color:new s.Ilk("#FFFFFF"),scale:new s.Vector3(1,1,1),isSelectable:!0};return o}getFirstAndLastFrames(t,e,i){let o=[],n=[];if(!t||0===t.length)return console.error("No valid end frame data available for landing transition"),[[],[]];let r=t.length,a=Math.ceil(Math.sqrt(r));this.boundingBox||(this.boundingBox=new s.ZzF);for(let l=0;l<r;l++){o.push({position:t[l].position.clone().multiply(i).add(e),color:t[l].color.clone(),scale:t[l].scale.clone(),isSelectable:void 0===t[l].isSelectable||t[l].isSelectable});let r=Math.floor(l/a),h=l-r*a,m=new s.Vector3(h-a/2,0,r-a/2).multiplyScalar(2);m.set(m.x,m.z,m.y),n.push({position:m,color:t[l].color.clone(),scale:new s.Vector3(1,1,1),isSelectable:void 0===t[l].isSelectable||t[l].isSelectable}),this.boundingBox.expandByPoint(o[o.length-1].position),this.boundingBox.expandByPoint(n[n.length-1].position)}return this.visualBoundingBox||(this.visualBoundingBox=new s.ZzF),this.visualBoundingBox.copy(this.boundingBox),[o,n]}computeMinimumProximityDistance(){let t=Number.MAX_VALUE;for(let e=0;e<this.rawFrames.length;e++)t=0;this.minimumProximityDistance=t}computeMaximumDroneSpeed(){if(!this.rawFrames||this.rawFrames.length<=1){this.maximumSpeed=0;return}let t=this.droneCount,e=this.rawFrames.length,i=this.formationSize/1e3*24,s=0;for(let i=0;i<e-1;i++){let e=this.rawFrames[i],o=this.rawFrames[i+1];for(let i=0;i<t;i++){let t=3*i,n=e[t],r=e[t+1],a=e[t+2],l=o[t],h=o[t+1],m=o[t+2],d=l-n,c=h-r,u=m-a;s=Math.max(s,d*d+c*c+u*u)}}this.maximumSpeed=Math.sqrt(s)*i,this._cachedMaxSpeed=this.maximumSpeed}shiftAnimationTime(t){let e=this.getAnimationLength()+t;this.animationFrames=n.generateInterpolatedFramesOverTime(this.firstAndLastFrames[0],this.firstAndLastFrames[1],e,this.fps),this.computeMinimumProximityDistance(),this.computeMaximumDroneSpeed()}setFormationSize(){}async recalculateAnimation(){let t;let e=this.fromAnimatedPointCloud.rawFrames.length-1,i=this.fromAnimatedPointCloud.rawFrames[e],s=this.fromAnimatedPointCloud.frameColors[e]||[];t=this.createFrameObjectsFromRawData(i,s,this.fromAnimatedPointCloud.droneCountWithoutExtraDrones||this.fromAnimatedPointCloud.droneCount),this.firstAndLastFrames=this.getFirstAndLastFrames(t,this.fromAnimatedPointCloud.position_offset,this.fromAnimatedPointCloud.position_scale);let o=Math.max(1,Math.ceil(this.getAnimationLength()*this.fps)),n=this.firstAndLastFrames[0].length;this.rawFrames=[],this.frameColors=[];for(let t=0;t<o;t++){let e=t/(o-1),i=new Float32Array(3*n),s=Array(n);for(let t=0;t<n;t++){let o=3*t,n=this.firstAndLastFrames[0][t].position,r=this.firstAndLastFrames[1][t].position;i[o]=n.x+(r.x-n.x)*e,i[o+1]=n.y+(r.y-n.y)*e,i[o+2]=n.z+(r.z-n.z)*e;let a=this.firstAndLastFrames[0][t].color,l=this.firstAndLastFrames[1][t].color,h=a.clone().lerp(l,e);s[t]=h.getHexString()}this.rawFrames.push(i),this.frameColors.push(s)}this.droneCount=n,await this.applyEffects(),this.initialize_drone_offsets(),this.computeMaximumDroneSpeed(),this.computeMinimumProximityDistance(),this.computeGranularSpeeds()}computeBoundingBox(){let t=this.firstAndLastFrames[0].length,e=[],i=[];for(let s=0;s<t;s++){let t=this.firstAndLastFrames[0][s].position.clone(),o=this.firstAndLastFrames[1][s].position.clone();e.push(t.clone()),e.push(o.clone()),t.set(t.x,t.z,-1*t.y),o.set(o.x,o.z,-1*o.y),i.push(t),i.push(o)}this.boundingBox.setFromPoints(e),this.worldBoundingBox.copy(this.boundingBox),this.visualBoundingBox.setFromPoints(i)}computeGranularSpeeds(){if(!this.firstAndLastFrames||2!==this.firstAndLastFrames.length){this.maxUpSpeed=0,this.maxDownSpeed=0,this.maxHorizontalSpeed=0,this.maxForwardSpeed=0,this.maxBackwardSpeed=0;return}let t=this.firstAndLastFrames[0],e=this.firstAndLastFrames[1],i=t.length,s=0,o=0,n=0,r=0,a=0;for(let l=0;l<i;l++)if(t[l]&&e[l]){let i=t[l].position,h=e[l].position,m=h.x-i.x,d=h.y-i.y,c=h.z-i.z,u=Math.abs(m)/this.getAnimationLength(),f=Math.abs(d)/this.getAnimationLength(),p=Math.abs(c)/this.getAnimationLength();m>0?r=Math.max(r,u):m<0&&(a=Math.max(a,u)),0!==d&&(n=Math.max(n,f)),c>0?s=Math.max(s,p):c<0&&(o=Math.max(o,p))}this.maxUpSpeed=1.5*s,this.maxDownSpeed=1.5*o,this.maxHorizontalSpeed=1.5*n,this.maxForwardSpeed=1.5*r,this.maxBackwardSpeed=1.5*a}computeMetricsAsync(){if(!this.rawFrames||0===this.rawFrames.length){console.log("No raw frames available for metrics computation in landing transition");return}this.computeMaximumDroneSpeed(),this.computeMinimumProximityDistance(),this.computeGranularSpeeds()}constructor(t,e){let i;super(),this.fromAnimatedPointCloud=t;let s=t.rawFrames.length-1,o=t.rawFrames[s],n=t.frameColors[s];i=this.createFrameObjectsFromRawData(o,n,t.droneCountWithoutExtraDrones||t.droneCount),this.firstAndLastFrames=this.getFirstAndLastFrames(i,t.position_offset,t.position_scale),this.fps=24;let r=Math.max(1,Math.ceil(e*this.fps)),a=this.firstAndLastFrames[0].length;this.rawFrames=[],this.frameColors=[];for(let t=0;t<r;t++){let e=t/(r-1),i=new Float32Array(3*a),s=Array(a);for(let t=0;t<a;t++){let o=3*t,n=this.firstAndLastFrames[0][t].position,r=this.firstAndLastFrames[1][t].position;i[o]=n.x+(r.x-n.x)*e,i[o+1]=n.y+(r.y-n.y)*e,i[o+2]=n.z+(r.z-n.z)*e;let a=this.firstAndLastFrames[0][t].color,l=this.firstAndLastFrames[1][t].color,h=a.clone().lerp(l,e);s[t]=h.getHexString()}this.rawFrames.push(i),this.frameColors.push(s)}this.isTransition=!0,this.frustumCulled=!1,this.computeBoundingBox(),this.initialize_drone_offsets(),this.recalculateAnimation()}}class a extends o.F{createFrameObjectsFromRawData(t,e,i){if(!t)return console.error("No coordinate data provided for frame conversion"),[];let o=Array(i),n=Math.min(i,Math.floor(t.length/3)),r=new s.Vector3,a=new s.Vector3(1,1,1);for(let i=0;i<n;i++){let n=3*i;r.set(t[n],t[n+1],t[n+2]);let l=e&&e[i]?e[i]:"FFFFFF",h=l.startsWith("#")?l:"#".concat(l);o[i]={position:r.clone(),color:new s.Ilk(h),scale:a.clone(),isSelectable:!0}}for(let t=n;t<i;t++)o[t]={position:new s.Vector3(0,0,0),color:new s.Ilk("#FFFFFF"),scale:new s.Vector3(1,1,1),isSelectable:!0};return o}getFirstAndLastFrames(t,e,i){let o=[],n=[];if(!t||0===t.length)return console.error("No valid start frame data available for takeoff transition"),[[],[]];let r=t.length;this.boundingBox||(this.boundingBox=new s.ZzF);let a=Math.ceil(Math.sqrt(r));for(let l=0;l<r;l++){let r=Math.floor(l/a),h=l-r*a,m=new s.Vector3(h-a/2,0,r-a/2).multiplyScalar(2);m.set(m.x,m.z,m.y),o.push({position:m,color:t[l].color.clone(),scale:new s.Vector3(1,1,1),isSelectable:void 0===t[l].isSelectable||t[l].isSelectable}),n.push({position:t[l].position.clone().multiply(i).add(e),color:t[l].color.clone(),scale:t[l].scale.clone(),isSelectable:void 0===t[l].isSelectable||t[l].isSelectable}),this.boundingBox.expandByPoint(o[o.length-1].position),this.boundingBox.expandByPoint(n[n.length-1].position)}return this.visualBoundingBox||(this.visualBoundingBox=new s.ZzF),this.visualBoundingBox.copy(this.boundingBox),[o,n]}computeMinimumProximityDistance(){let t=Number.MAX_VALUE;for(let e=0;e<this.animationFrames.length;e++)t=Math.min(t,this.computeMinimumProximityBetweenPointsOnFrame(e));this.minimumProximityDistance=t}computeMaximumDroneSpeed(){return 0}shiftAnimationTime(t){let e=this.getAnimationLength()+t;this.animationFrames=n.generateInterpolatedFramesOverTime(this.firstAndLastFrames[0],this.firstAndLastFrames[1],e,this.fps),this.computeMinimumProximityDistance(),this.computeMaximumDroneSpeed()}setFormationSize(){}async recalculateAnimation(){let t;if(this.toAnimatedPointCloud.rawFrames&&this.toAnimatedPointCloud.rawFrames.length>0&&this.toAnimatedPointCloud.droneCount>0){let e=this.toAnimatedPointCloud.rawFrames[0],i=this.toAnimatedPointCloud.frameColors[0]||[];t=this.createFrameObjectsFromRawData(e,i,this.toAnimatedPointCloud.droneCountWithoutExtraDrones||this.toAnimatedPointCloud.droneCount)}else if(this.toAnimatedPointCloud.animationFrames&&this.toAnimatedPointCloud.animationFrames.length>0)console.log("Using legacy frames for recalculating takeoff transition"),t=this.toAnimatedPointCloud.animationFrames[0];else{console.error("No valid frame data found for recalculating takeoff transition");return}this.firstAndLastFrames=this.getFirstAndLastFrames(t,this.toAnimatedPointCloud.position_offset,this.toAnimatedPointCloud.position_scale);let e=Math.max(1,Math.ceil(this.getAnimationLength()*this.fps)),i=this.firstAndLastFrames[0].length;this.rawFrames=[],this.frameColors=[];for(let t=0;t<e;t++){let s=t/(e-1),o=new Float32Array(3*i),n=Array(i);for(let t=0;t<i;t++){let e=3*t,i=this.firstAndLastFrames[0][t].position,r=this.firstAndLastFrames[1][t].position;o[e]=i.x+(r.x-i.x)*s,o[e+1]=i.y+(r.y-i.y)*s,o[e+2]=i.z+(r.z-i.z)*s;let a=this.firstAndLastFrames[0][t].color,l=this.firstAndLastFrames[1][t].color,h=a.clone().lerp(l,s);n[t]=h.getHexString()}this.rawFrames.push(o),this.frameColors.push(n)}this.droneCount=i,await this.applyEffects(),this.initialize_drone_offsets(),this.computeMaximumDroneSpeed(),this.computeMinimumProximityDistance(),this.computeGranularSpeeds()}computeBoundingBox(){let t=this.firstAndLastFrames[0].length,e=[],i=[];for(let s=0;s<t;s++){let t=this.firstAndLastFrames[0][s].position.clone(),o=this.firstAndLastFrames[1][s].position.clone();e.push(t.clone()),e.push(o.clone()),t.set(t.x,t.z,-1*t.y),o.set(o.x,o.z,-1*o.y),i.push(t),i.push(o)}this.boundingBox.setFromPoints(e),this.worldBoundingBox.copy(this.boundingBox),this.visualBoundingBox.setFromPoints(i)}computeGranularSpeeds(){if(!this.firstAndLastFrames||2!==this.firstAndLastFrames.length){this.maxUpSpeed=0,this.maxDownSpeed=0,this.maxHorizontalSpeed=0,this.maxForwardSpeed=0,this.maxBackwardSpeed=0;return}let t=this.firstAndLastFrames[0],e=this.firstAndLastFrames[1],i=t.length,s=0,o=0,n=0,r=0,a=0;for(let l=0;l<i;l++)if(t[l]&&e[l]){let i=t[l].position,h=e[l].position,m=h.x-i.x,d=h.y-i.y,c=h.z-i.z,u=Math.abs(m)/this.getAnimationLength(),f=Math.abs(d)/this.getAnimationLength(),p=Math.abs(c)/this.getAnimationLength();m>0?r=Math.max(r,u):m<0&&(a=Math.max(a,u)),0!==d&&(n=Math.max(n,f)),c>0?s=Math.max(s,p):c<0&&(o=Math.max(o,p))}this.maxUpSpeed=1.5*s,this.maxDownSpeed=1.5*o,this.maxHorizontalSpeed=1.5*n,this.maxForwardSpeed=1.5*r,this.maxBackwardSpeed=1.5*a}computeMetricsAsync(){if(!this.rawFrames||0===this.rawFrames.length){console.log("No raw frames available for metrics computation in takeoff transition");return}this.computeMaximumDroneSpeed(),this.computeMinimumProximityDistance(),this.computeGranularSpeeds()}constructor(t,e){let i;super(),this.toAnimatedPointCloud=t;let s=t.rawFrames[0],o=t.frameColors[0]||[];i=this.createFrameObjectsFromRawData(s,o,t.droneCountWithoutExtraDrones||t.droneCount),this.firstAndLastFrames=this.getFirstAndLastFrames(i,t.position_offset,t.position_scale),this.fps=24;let n=Math.max(1,Math.ceil(e*this.fps)),r=this.firstAndLastFrames[0].length;this.rawFrames=[],this.frameColors=[];for(let t=0;t<n;t++){let e=t/(n-1),i=new Float32Array(3*r),s=Array(r);for(let t=0;t<r;t++){let o=3*t,n=this.firstAndLastFrames[0][t].position,r=this.firstAndLastFrames[1][t].position;i[o]=n.x+(r.x-n.x)*e,i[o+1]=n.y+(r.y-n.y)*e,i[o+2]=n.z+(r.z-n.z)*e;let a=this.firstAndLastFrames[0][t].color,l=this.firstAndLastFrames[1][t].color,h=a.clone().lerp(l,e);s[t]=h.getHexString()}this.rawFrames.push(i),this.frameColors.push(s)}this.isTransition=!0,this.frustumCulled=!1,this.computeBoundingBox(),this.initialize_drone_offsets()}}var l=i(53161),h=i(54539),m=i(30656);async function d(t,e,i,s){let o=(await h.g.currentAuthenticatedUser()).signInUserSession.idToken.jwtToken,n=l.Z.calculate_transition_mapping_and_store_results;return await (0,m.Z)({method:"post",baseURL:"https://"+n+".execute-api.us-east-1.amazonaws.com/prod",headers:{Authorization:o},data:{sourceCoordinates:t,targetCoordinates:e,formation_to_id:i,formation_from_id:s}})}class c extends o.F{initialize_drone_offsets(){this.drone_offsets=[];let t=this.firstAndLastFrames[0].length;for(let e=0;e<t;e++)this.drone_offsets.push(new s.Vector3(0,0,0))}computeBoundingBox(){let t=this.firstAndLastFrames[0].length,e=[],i=[];for(let s=0;s<t;s++){let t=this.firstAndLastFrames[0][s].position.clone(),o=this.firstAndLastFrames[1][s].position.clone();e.push(t.clone()),e.push(o.clone()),t.set(t.x,t.z,-1*t.y),o.set(o.x,o.z,-1*o.y),i.push(t),i.push(o)}this.boundingBox.setFromPoints(e),this.worldBoundingBox.copy(this.boundingBox),this.visualBoundingBox.setFromPoints(i)}getFirstAndLastFrames(t,e,i){let s,o;let n=t.rawFrames.length-1,r=t.rawFrames[n],a=t.frameColors[n];s=this.createFrameObjectsFromRawData(r,a,t);let l=e.rawFrames[0],h=e.frameColors[0];o=this.createFrameObjectsFromRawData(l,h,e);let m=Math.min(s.length,o.length),d=this.validateMapping(i,s.length,m),c=[],u=[];for(let t=0;t<m;t++){let e=d?d[t]:t;c.push({position:s[e].position.clone(),color:s[e].color.clone(),scale:s[e].scale.clone(),isSelectable:s[e].isSelectable}),u.push({position:o[t].position.clone(),color:o[t].color.clone(),scale:o[t].scale.clone(),isSelectable:o[t].isSelectable})}return[c,u]}createFrameObjectsFromRawData(t,e,i){let o=t.length/3,n=[];for(let r=0;r<o;r++){let o=t[3*r+0],a=t[3*r+1],l=t[3*r+2],h=new s.Vector3(o,a,l);h.multiply(i.position_scale).add(i.position_offset),n.push({position:h,color:new s.Ilk(e?"#"+e[r]:"#000000"),scale:new s.Vector3(1,1,1),isSelectable:!0})}return n}validateMapping(t,e,i){if(!t||0===t.length)return null;let s=[];for(let o=0;o<i;o++)o<t.length&&t[o]>=0&&t[o]<e?s.push(t[o]):s.push(o%e);return s}computeMinimumProximityDistance(){let t=1e3;if(this.animationFrames&&this.animationFrames.length>0)for(let e=0;e<this.animationFrames.length;e++)t=Math.min(t,this.computeMinimumProximityBetweenPointsOnFrame(e));else if(this.rawFrames&&this.rawFrames.length>0)for(let e=0;e<this.rawFrames.length;e++){let i=this.rawFrames[e],o=i.length/3;for(let e=0;e<o;e++){let n=3*e,r=new s.Vector3(i[n],i[n+1],i[n+2]);for(let n=e+1;n<o;n++){let e=3*n,o=new s.Vector3(i[e],i[e+1],i[e+2]);t=Math.min(t,r.distanceTo(o))}}}this.minimumProximityDistance=t}computeMaximumDroneSpeed(){let t=this.getFrameData(0,!0),e=this.getFrameData(1,!0),i=t.length,s=0;for(let o=0;o<i;o++)if(t[o]&&e[o]){let i=t[o].position.distanceTo(e[o].position)/this.getAnimationLength();i>s&&(s=i)}s*=1.5,this.maximumSpeed=s}computeGranularSpeeds(){let t=this.getFrameData(0,!0),e=this.getFrameData(1,!0),i=t.length,s=0,o=0,n=0,r=0,a=0,l=this.getAnimationLength();for(let h=0;h<i;h++)if(t[h]&&e[h]){let i=t[h].position,m=e[h].position,d=m.x-i.x,c=m.y-i.y,u=m.z-i.z,f=Math.abs(d)/l,p=Math.abs(c)/l,g=Math.abs(u)/l;d>0?r=Math.max(r,f):d<0&&(a=Math.max(a,f)),0!==c&&(n=Math.max(n,p)),u>0?s=Math.max(s,g):u<0&&(o=Math.max(o,g))}this.maxUpSpeed=1.5*s,this.maxDownSpeed=1.5*o,this.maxHorizontalSpeed=1.5*n,this.maxForwardSpeed=1.5*r,this.maxBackwardSpeed=1.5*a}async shiftAnimationTime(t){let e=Math.ceil((this.getAnimationLength()+t)*this.fps),i=this.rawFrames[0].length/3;this.rawFrames=[],this.frameColors=[];for(let t=0;t<e;t++){let s=t/(e-1),o=new Float32Array(3*i),n=Array(i);for(let t=0;t<i;t++){let e=3*t,i=this.firstAndLastFrames[0][t].position,r=this.firstAndLastFrames[1][t].position;o[e]=i.x+(r.x-i.x)*s,o[e+1]=i.y+(r.y-i.y)*s,o[e+2]=i.z+(r.z-i.z)*s;let a=this.firstAndLastFrames[0][t].color,l=this.firstAndLastFrames[1][t].color;n[t]=a.clone().lerp(l,s).getHexString()}this.rawFrames.push(o),this.frameColors.push(n)}await this.recalculateAnimation()}setFormationSize(){}setShowOffset(){}async recalculateAnimation(){this.isRecalculating=!0;let t=this.getFirstAndLastFrames(this.fromAnimatedPointCloud,this.toAnimatedPointCloud),e=t[0],i=t[1],s=[];for(let t=0;t<e.length;t++)e[t]&&e[t].position&&s.push([e[t].position.x,e[t].position.y,e[t].position.z]);let o=[];for(let t=0;t<i.length;t++)i[t]&&i[t].position&&o.push([i[t].position.x,i[t].position.y,i[t].position.z]);let n=await d(s,o,this.toAnimatedPointCloud.name,this.fromAnimatedPointCloud.name);if(n&&n.data){this.minimumProximityDistance=n.data.clearence_value_report;let t=n.data.mapping_array;this.mapping=this.validateMapping(t,e.length,s.length),console.log("MAPPING RESPONSE",this.mapping),this.firstAndLastFrames=this.getFirstAndLastFrames(this.fromAnimatedPointCloud,this.toAnimatedPointCloud,this.mapping)}let r=Math.ceil(24*this.getAnimationLength()),a=s.length;this.rawFrames=[],this.frameColors=[];for(let t=0;t<r;t++){let e=t/(r-1),i=new Float32Array(3*a),s=Array(a);for(let t=0;t<a;t++)if(t<this.firstAndLastFrames[0].length&&t<this.firstAndLastFrames[1].length){var l,h,m,c,u,f;let o=3*t,n=null!==(u=null===(l=this.firstAndLastFrames[0][t])||void 0===l?void 0:l.position)&&void 0!==u?u:{x:0,y:0,z:0},r=null!==(f=null===(h=this.firstAndLastFrames[1][t])||void 0===h?void 0:h.position)&&void 0!==f?f:{x:0,y:0,z:0};i[o]=n.x+(r.x-n.x)*e,i[o+1]=n.y+(r.y-n.y)*e,i[o+2]=n.z+(r.z-n.z)*e;let a=null===(m=this.firstAndLastFrames[0][t])||void 0===m?void 0:m.color,d=null===(c=this.firstAndLastFrames[1][t])||void 0===c?void 0:c.color,p=a?a.clone().lerp(d,e):"#ffffff";s[t]="#ffffff"===p?"#ffffff":p.getHexString()}this.rawFrames.push(i),this.frameColors.push(s)}this.computeMetrics(),this.applyEffects(),this.initialize_drone_offsets(),this.isRecalculating=!1,console.log("✅✅✅✅✅Transition recalculation completed successfully")}async add_effect(t){console.log("ADD EFFECT ON TRANSITION",t),this.effects.push(t),await this.applyEffects()}computeMinimumProximityBetweenPointsOnFrame(t){if(this.animationFrames&&this.animationFrames.length>t){let e=this.animationFrames[t],i=1e3;for(let t=0;t<e.length;t++)for(let s=t+1;s<e.length;s++)i=Math.min(i,e[t].position.distanceTo(e[s].position));return i}if(this.rawFrames&&this.rawFrames.length>t){let e=this.rawFrames[t],i=e.length/3,o=1e3;for(let t=0;t<i;t++){let n=3*t,r=new s.Vector3(e[n],e[n+1],e[n+2]);for(let n=t+1;n<i;n++){let t=3*n,i=new s.Vector3(e[t],e[t+1],e[t+2]);o=Math.min(o,r.distanceTo(i))}}return o}return 1e3}extend_frames(t){if(!(t<=0)){if(this.rawFrames&&this.rawFrames.length>0){let e=this.rawFrames.length-1,i=this.rawFrames[e],s=this.frameColors[e]||[];for(let e=0;e<t;e++){let t=new Float32Array(i.length);t.set(i);let e=Array.from(s);this.rawFrames.push(t),this.frameColors.push(e)}}this.recalculateAnimation()}}computeMetricsAsync(){this.computeMetrics()}computeMetrics(){this.computeMaximumDroneSpeed(),this.computeMinimumProximityDistance(),this.computeGranularSpeeds()}convert_local_to_visual(t){this.convert_world_to_visual(t)}convert_visual_to_local(t){this.convert_visual_to_world(t)}convert_visual_to_local_direction(t){this.convert_visual_to_world_direction(t)}convert_local_to_visual_direction(t){this.convert_world_to_visual(t)}convert_local_to_world(t){return t}constructor(t,e,i,s){super(),this.fromAnimatedPointCloud=t,this.toAnimatedPointCloud=e,this.mapping=s;for(let t=0;t<s.length;t++)this.mapping[t]=parseInt(s[t]);this.isRecalculating=!1;let o=t.rawFrames[0].length/3;this.rawFrames=[],this.frameColors=[],this.firstAndLastFrames=this.getFirstAndLastFrames(t,e,this.mapping),this.fps=24;let n=Math.ceil(i*this.fps);for(let t=0;t<n;t++){let e=t/(n-1),i=new Float32Array(3*o),s=Array(o);for(let t=0;t<o;t++){var r,a,l,h,m,d;let o=null!==(m=null===(r=this.firstAndLastFrames[0][t])||void 0===r?void 0:r.position)&&void 0!==m?m:{x:0,y:0,z:0},n=null!==(d=null===(a=this.firstAndLastFrames[1][t])||void 0===a?void 0:a.position)&&void 0!==d?d:{x:0,y:0,z:0};i[3*t+0]=o.x+(n.x-o.x)*e,i[3*t+1]=o.y+(n.y-o.y)*e,i[3*t+2]=o.z+(n.z-o.z)*e;let c=null===(l=this.firstAndLastFrames[0][t])||void 0===l?void 0:l.color,u=null===(h=this.firstAndLastFrames[1][t])||void 0===h?void 0:h.color,f=c?c.clone().lerp(u,e):"#ffffff";s[t]="#ffffff"===f?"#ffffff":f.getHexString()}this.rawFrames.push(i),this.frameColors.push(s)}this.isTransition=!0,this.frustumCulled=!1,this.maxUpSpeed=-1,this.maxDownSpeed=-1,this.maxHorizontalSpeed=-1,this.maxForwardSpeed=-1,this.maxBackwardSpeed=-1,this.computeBoundingBox(),this.computeMetrics(),this.initialize_drone_offsets(),console.log("✓ Transition ".concat(this.fromAnimatedPointCloud.name," → ").concat(this.toAnimatedPointCloud.name," initialized with ").concat(this.rawFrames.length," frames")),this.recalculateAnimation()}}class u{get animationFrames(){return this.__animatedPointCloud.animationFrames}get fps(){return this.__animatedPointCloud.fps}get animationLength(){return this.__animatedPointCloud.getAnimationLength()}restoreOriginalAnimation(){this.__animatedPointCloud.restoreOriginalAnimation()}add_effect(t){this.__animatedPointCloud.add_effect(t)}remove_effect(t){this.__animatedPointCloud.remove_effect(t)}constructor(t){this.__animatedPointCloud=t}}class f extends s.Tme{setFormationData(t,e,i,s,n,r,a,l,h,m,d,c){let u=new o.F;u.setAnimationData(e,i,s,n,r,a,l,h,m,d,c),this.setFormation(t,u)}setFormation(t,e){void 0===this.formations[t]&&(e.name=t,this.formations[t]=e,this.add(e),this.updateFormationRequestOnLoad(t,e))}hideAll(){Object.values(this.formations).forEach(t=>{t.visible=!1})}getFormation(t){return this.formations[t]}getEditableFormation(t){return new Promise(e=>{void 0!==this.formations[t]?e(this.formations[t]):this.formation_requests[t]=e})}getFormationIDS(){return Object.keys(this.formations).map(t=>t)}getOrCreateTransitionFormation(t,e,i,s,o){let n=this.formations[t];if(void 0===n){let r=this.getFormation(e),a=this.getFormation(i);r&&a&&((n=new c(r,a,s,o)).name=t,this.formations[t]=n,this.add(n),this.updateFormationRequestOnLoad(t,n))}return n}getTransitionFormation(t,e,i,s,o){return this.getOrCreateTransitionFormation(t,e,i,s,o)}getTransitionTakeoffFormation(t,e,i){let s=this.formations[t];if(void 0===s){let o=this.getFormation(e);o&&((s=new a(o,i)).name=t,this.formations[t]=s,this.add(s),this.updateFormationRequestOnLoad(t,s))}return s}getTransitionLandingFormation(t,e,i){let s=this.formations[t];if(void 0===s){let o=this.getFormation(e);o&&((s=new r(o,i)).name=t,this.formations[t]=s,this.add(s),this.updateFormationRequestOnLoad(t,s))}return s}removeAllFormations(){let t=Object.keys(this.formations);for(let e=0;e<t.length;e++)this.removeFormation(t[e])}removeFormation(t){let e=this.formations[t];e&&(e.dispose(),this.remove(e),delete this.formations[t])}removeAllTransitions(){let t=Object.values(this.formations).filter(t=>t.isTransition);for(let e=0;e<t.length;e++)this.removeFormation(t[e].name)}updateFormationRequestOnLoad(t,e){void 0!==this.formation_requests[t]&&(this.formation_requests[t](new u(e)),this.formation_requests[t]=void 0)}getVisibleFormations(){return Object.values(this.formations).filter(t=>t.visible)}getAllFormations(){return Object.values(this.formations)}clearSelectionInformation(){let t=this.getAllFormations();for(let e=0;e<t.length;e++)t[e].clearSelection()}constructor(){super(),this.formations={},this.formation_requests={},this.boundingBoxHelper=new s.GQ(new s.ZzF,"#00FF00"),this.add(this.boundingBoxHelper),this.boundingBoxHelper.visible=!1}}},54597:function(t,e,i){i.d(e,{T:function(){return h}});var s=i(16950),o=i(12537),n=i(65254),r=i(5435),a=i(79787),l=i(94806);class h{getCanvas(){return this.webglRenderer.domElement}render(t){this.resizeIfNeeded(),t?(this.occlusion_camera.copy(this.camera),this.occlusion_camera.layers.set(3),this.camera.layers.set(5),this.bloomComposer.render(),this.camera.layers.set(0),this.finalComposer.render()):this.webglRenderer.render(this.scene,this.camera)}resizeIfNeeded(){if(this.containerSize.width!==this.DOMContainer.clientWidth||this.containerSize.height!==this.DOMContainer.clientHeight){let t=this.DOMContainer.clientWidth,e=this.DOMContainer.clientHeight;this.containerSize.width=t,this.containerSize.height=e,this.webglRenderer.setPixelRatio(1),this.finalComposer.setPixelRatio(1),this.webglRenderer.setSize(t,e),this.bloomComposer.setSize(t,e),this.finalComposer.setSize(t,e),this.camera.aspect=t/e,this.camera.updateProjectionMatrix()}}dispose(){this.webglRenderer.dispose(),this.DOMContainer.removeChild(this.getCanvas())}setBackgroundColor(t){this.webglRenderer.setClearColor(new l.Ilk(t))}setBloomStrength(t){this.bloomPass.copyUniforms.opacity.value=t}constructor(t,e,i){this.scene=t,this.camera=e,this.occlusion_camera=e.clone(),this.occlusion_camera.layers.set(3),this.DOMContainer=i,this.containerSize={width:1,height:1},this.webglRenderer=new l.CP7({antialias:!0}),this.webglRenderer.setSize(1,1),i.appendChild(this.webglRenderer.domElement),this.occlusion_RT=new l.ACn(1,1),this.occlusionMaterial=new l.vBJ({color:"#000000"}),this.webglRenderer.domElement.style.position="absolute";let h=new n.C(this.scene,this.camera),m=new n.C(this.scene,this.camera);m.clear=!1;let d=new n.C(this.scene,this.occlusion_camera,this.occlusionMaterial,new l.Ilk("#000000"),1),c=new a.m(new l.FM8(1,1),.4,1,0);this.bloomPass=c;let u=new s.x(this.webglRenderer);u.renderToScreen=!1,u.addPass(d),u.addPass(m),u.addPass(c),this.bloomComposer=u,this.bloom_scene=new l.xsS;let f=new o.T(new l.jyz({uniforms:{baseTexture:{value:null},bloomTexture:{value:u.renderTarget2.texture}},vertexShader:"\n          varying vec2 vUv;\n\n          void main() {\n\n            vUv = uv;\n\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n          }\n        ",fragmentShader:"\n          uniform sampler2D baseTexture;\n          uniform sampler2D bloomTexture;\n\n          varying vec2 vUv;\n\n          void main() {\n\n            gl_FragColor = ( texture2D( baseTexture, vUv ) + vec4( 1.0 ) * texture2D( bloomTexture, vUv ) );\n\n          }\n        ",defines:{}}),"baseTexture");f.needsSwap=!0;let p=new r.v,g=new s.x(this.webglRenderer);g.addPass(h),g.addPass(f),g.addPass(p),this.finalComposer=g}}},94381:function(t,e,i){i.d(e,{Z:function(){return o}});class s{constructor(){this.particle_size=1,this.map={color:"#FFFFFF"}}}let o=new s},41313:function(t,e,i){i.d(e,{T:function(){return s}});class s{update(t){let e=t-this.lastElapsedTime;this.elapsedTime+=e,this.playing&&(this.animationTime+=e*this.timeScale),this.deltaTime=e,this.lastElapsedTime=this.elapsedTime}play(){this.playing=!0}pause(){this.playing=!1}stop(){this.pause(),this.reset()}reset(){this.animationTime=0}setTime(t){this.animationTime=t}constructor(){this.elapsedTime=0,this.lastElapsedTime=0,this.deltaTime=0,this.playing=!0,this.animationTime=45,this.timeScale=1}}},99351:function(t,e,i){i.d(e,{c:function(){return n}});var s=i(27236),o=i(50017);class n{updateSegments(t){t.length>0&&(this.formationContainer.removeAllTransitions(),this.segments=this.parseVideoSegments(t),this.initializeFormationsIfAlreadyLoaded())}displayFormationBoundingBoxes(t){this.showBoundingBox=t}update(){this.formationContainer.hideAll(),this.initializeFormationsIfAlreadyLoaded();let t=this.timeline.animationTime,e=this.getSegmentAtTime(t);if(this.formationContainer.boundingBoxHelper.visible=this.showBoundingBox,e){let i=this.getFormationFromSegment(e);if(i){i.visible=!0;let s=e.endTime-e.startTime,o=(t-e.startTime)/s;i.setNormalizedTime(o,!0),this.formationContainer.boundingBoxHelper.visible&&(this.formationContainer.boundingBoxHelper.box=i.visualBoundingBox,this.formationContainer.boundingBoxHelper.updateMatrixWorld()),this.showLoadingIcon=!1}else this.showLoadingIcon=!0}this.updateUIElements()}getSegmentAtTime(t){for(let e=0;e<this.segments.length;e++)if(t>=this.segments[e].startTime&&t<this.segments[e].endTime)return this.segments[e]}parseVideoSegments(t){let e=[];for(let i=1;i<t.length-1;i++)if(t[i].formationUUID&&t[i].formationUUID.includes("transition")){let s=t[i-1].formationUUID,o=t[i+1].formationUUID;e.push({formationID:t[i].formationUUID,fromFormationID:s,toFormationID:o,startTime:parseFloat(t[i].startTimeInSeconds),endTime:parseFloat(t[i].endTimeInSeconds),mapping:t[i].mapping,isTransition:!0})}else e.push({formationID:t[i].formationUUID,startTime:parseFloat(t[i].startTimeInSeconds),endTime:parseFloat(t[i].endTimeInSeconds),isTransition:!1});e.unshift({formationID:t[0].formationUUID,toFormationID:t[1].formationUUID,startTime:parseFloat(t[0].startTimeInSeconds),endTime:parseFloat(t[0].endTimeInSeconds),isTransition:!0,isTakeoff:!0}),e.push({formationID:t[t.length-1].formationUUID,fromFormationID:e[e.length-1].formationID,startTime:parseFloat(t[t.length-1].startTimeInSeconds),endTime:parseFloat(t[t.length-1].endTimeInSeconds),isTransition:!0,isLanding:!0});for(let i=0;i<e.length;i++)e[i].originalStartTime=e[i].startTime,e[i].originalEndTime=e[i].endTime,e[i].UIElement=t[i];return e}getSegmentById(t){return this.segments.find(e=>e.formationID===t)}lengthenSegment(t,e){let i=this.getSegmentById(t),o=this.getFormationFromSegment(i);o&&(new s.f(e).applyTo(o),this.sync_segments_with_formation_lengths(),!1===i.isTransition&&this.updateNeighboringTransitions(t))}shortenSegment(t,e){let i=this.getSegmentById(t),s=this.getFormationFromSegment(i);s&&(new o.a(e).applyTo(s),this.sync_segments_with_formation_lengths(),!1===i.isTransition&&this.updateNeighboringTransitions(t))}sync_segments_with_formation_lengths(){let t=0;for(let e=0;e<this.segments.length;e++){let i=this.segments[e],s=this.getFormationFromSegment(i).getAnimationLength(),o=i.UIElement;i.startTime=t,i.endTime=i.startTime+s,t+=s,o.startTimeInSeconds=i.startTime,o.endTimeInSeconds=i.endTime}}restoreSegmentDuration(t){console.log("the formation uuid",t);let e=this.getSegmentById(t);if(console.log("segment inside restoreSegmentDuration",e),!e)return;let i=e.originalEndTime-e.originalStartTime-(e.endTime-e.startTime);console.log("timeOffset inside restoreSegmentDuration",i),i>0?this.lengthenSegment(t,Math.abs(i)):this.shortenSegment(t,Math.abs(i))}getSegmentDuration(t){let e=this.getSegmentById(t);return e.endTime-e.startTime}initializeFormationsIfAlreadyLoaded(){for(let t=0;t<this.segments.length;t++)this.getFormationFromSegment(this.segments[t])}getFormationFromSegment(t){let e;if(t.isTransition){let i=t.endTime-t.startTime;if(t.isTakeoff)e=this.formationContainer.getTransitionTakeoffFormation(t.formationID,t.toFormationID,i);else if(t.isLanding)e=this.formationContainer.getTransitionLandingFormation(t.formationID,t.fromFormationID,i);else{let s=t.formationID,o=t.fromFormationID,n=t.toFormationID,r=t.mapping,a=t.min_proximity,l=t.max_speed,h=t.UIElement.show_used_in;e=this.formationContainer.getTransitionFormation(s,o,n,i,r,a,l,h)}}else e=this.formationContainer.getFormation(t.formationID);return e}async setFormationSize(t,e){let i=this.formationContainer.getFormation(t);i&&i.setFormationSize(e),await this.updateNeighboringTransitions(t)}async setFormationOffset(t,e){let i=this.formationContainer.getFormation(t);i&&i.setFormationOffset(e),await this.updateNeighboringTransitions(t)}setShowOffset(t){let e=this.formationContainer.getAllFormations();for(let i=0;i<e.length;i++)e[i].setShowOffset(t);for(let t=0;t<this.segments.length;t++){let e=this.segments[t];if(e.isTransition){let t=this.formationContainer.getFormation(e.formationID);t&&t.recalculateAnimation()}}}async updateNeighboringTransitions(t){console.log("UPDATE NEIGHBORING TRANSITIONS TRIGGERED",t);let e=this.getSegmentById(t),i=this.segments.indexOf(e),s=this.segments[i-1].formationID,o=this.segments[i+1].formationID,n=this.formationContainer.getFormation(s);n&&(console.log("RECALCULATING PREVIOUS TRANSITION",n),await n.recalculateAnimation());let r=this.formationContainer.getFormation(o);r&&(console.log("RECALCULATING NEXT TRANSITION",r),await r.recalculateAnimation())}async getNeighboringTransitionIDs(t){console.log("GETTING NEIGHBORING TRANSITION IDs TRIGGERED",t);let e=this.getSegmentById(t),i=this.segments.indexOf(e),s=this.segments[i].UIElement.show_used_in;return{previous_transition_id:this.segments[i-1].formationID,next_transition_id:this.segments[i+1].formationID,showUUID:s}}async getAllTransitionIDsInShow(){var t=[];for(let e=0;e<this.segments.length;e++){let i=this.segments[e];i.isTransition&&t.push(i.formationID)}return t}updateUIElements(){for(let t=0;t<this.segments.length;t++){let e=this.segments[t],i=this.getFormationFromSegment(e);i&&(e.UIElement.abs_max_speed=i.maximumSpeed,e.UIElement.abs_min_dist=i.minimumProximityDistance,e.UIElement.formation_default_size=i.formationSize,e.UIElement.num_drones=i.getSelectableDroneCount())}}getActiveFormation(){let t=this.timeline.animationTime,e=this.getSegmentAtTime(t);return e?this.getFormationFromSegment(e):void 0}mergeFormations(t,e,i,s){if(console.log("Merging formations"),console.log("a",t),console.log("b",e),t.mergeWith(e,i,s),this.getSegmentById(t.name)){let e=this.getSegmentDuration(t.name);Math.abs(i-e)>.001&&(i>e?this.lengthenSegment(t.name,i-e):this.shortenSegment(t.name,e-i)),this.updateNeighboringTransitions(t.name)}}deleteDronesFromFormation(t,e){let i=this.getSegmentById(t);i&&(this.getFormationFromSegment(i).delete_drones(e),this.updateNeighboringTransitions(t))}getSegmentsBetween(t,e){let i=[];for(let s=0;s<this.segments.length;s++){let o=this.segments[s];(this.between(o.startTime,t,e)||this.between(o.endTime,t,e)||this.between(t,o.startTime,o.endTime)||this.between(e,o.startTime,o.endTime))&&i.push(o)}return i}between(t,e,i){return t>=e-.001&&t<=i+.001}getFormations(){let t=[];for(let e=0;e<this.segments.length;e++){let i=this.formationContainer.getFormation(this.segments[e].formationID);i&&t.push(i)}return t}constructor(t,e){this.formationContainer=t,this.timeline=e,this.showBoundingBox=!1,this.showLoadingIcon=!1,this.segments=[]}}},72317:function(t,e,i){i.d(e,{y:function(){return o}});var s=i(94806);class o{applyTo(t){}getSelectedDrones(t,e){if(0===e.length){let e=[],i=t.isTransition?t.getDroneCount():t.getSelectableDroneCount();for(let t=0;t<i;t++)e.push(t);return e}return e}get_bounding_box_at_frame(t,e){let i=new s.ZzF,o=new s.Vector3,n=e.rawFrames[t],r=e.isTransition?e.getDroneCount():e.getSelectableDroneCount();for(let t=0;t<r;t++){let s=n[3*t+0],r=n[3*t+1],a=n[3*t+2];o.set(s,r,a),!1===e.isTransition&&o.multiply(e.position_scale).add(e.position_offset),i.expandByPoint(o)}return i}is_drone_affected_by_area(t,e,i,s){return!e.enabled||(this.__vec3.x=s.rawFrames[i][3*t+0],this.__vec3.y=s.rawFrames[i][3*t+1],this.__vec3.z=s.rawFrames[i][3*t+2],!1===s.isTransition&&(this.__vec3.multiply(s.position_scale),this.__vec3.add(s.position_offset)),e.contains_point(this.__vec3))}constructor(t){this.uuid=s.MathUtils.generateUUID(),this.created_at=new Date,this.name=t,this.__vec3=new s.Vector3}}},34054:function(t,e,i){i.d(e,{J:function(){return o}});class s{constructor(){this.double_length_effect=-3,this.shorten_animation=-2,this.lengthen_animation=-1,this.multi_color_sparkling=0,this.single_color_sparkling=1,this.solid_color=2,this.still_gradient=3,this.color_cycle=4,this.fade=5,this.sparkle_while_keeping_shape=6,this.ripple=7,this.reveal=8,this.sync_to_music_sparkle_while_keeping_shape=9,this.flip_effect=10,this.rotate_effect=11,this.spin_effect=12,this.motion_wave=13,this.bounce=14,this.move_effect=15,this.change_length=16}}let o=new s},27236:function(t,e,i){i.d(e,{f:function(){return n}});var s=i(34054),o=i(72317);class n extends o.y{applyTo(t){console.warn("LengthenAnimation applyTo",t.name,this.time_to_add);let e=Math.floor(24*this.time_to_add);console.log("frame_count in lengthen animatino time to add",e),t.extend_frames(e),t.computeMetricsAsync()}constructor(t=0){super("LengthenAnimation"),this.apply_order=s.J.lengthen_animation,this.time_to_add=t}}},50017:function(t,e,i){i.d(e,{a:function(){return n}});var s=i(34054),o=i(72317);class n extends o.y{applyTo(t){t.shiftAnimationTime(-this.time_to_substract),t.computeMetricsAsync()}constructor(t=0){super("ShortenAnimation"),this.apply_order=s.J.shorten_animation,this.time_to_substract=t}}},33019:function(t,e,i){i.d(e,{Z:function(){return x}});var s=i(52676),o=i(75271),n=i(63026),r=i(59668),a=i.n(r),l=i(94806);class h extends l.SPe{setAnimationData(t,e,i,s,o,n,r){this.rawFrames=[],this.frameColors=[],this.originalRawFrames=[],this.originalFrameColors=[],Object.values(t).forEach(t=>{if(!t.coordinatesArray)return;let i=t.coordinatesArray.length/3,s=new Float32Array(3*i),o=Array(i);for(let n=0;n<i;n++){let i=3*n,r=0,a=0,h=0;e?(r=10,h=75+-.15*t.coordinatesArray[i],a=75+-.15*t.coordinatesArray[i+1]):(r=0+.15*t.coordinatesArray[i]*1,a=75+-.15*t.coordinatesArray[i+2]*1,h=75+-.15*t.coordinatesArray[i+1]*1),s[i]=r,s[i+1]=a,s[i+2]=h;let m=t.colorsArray[n]||"#FFFFFF";o[n]=m,this.boundingBox.expandByPoint(new l.Vector3(r,a,h))}this.rawFrames.push(s),this.frameColors.push(o);let n=new Float32Array(s),r=[...o];this.originalRawFrames.push(n),this.originalFrameColors.push(r)}),this.boundingBoxHelper.updateMatrixWorld()}setNormalizedTime(t,e){if(0===this.rawFrames.length)return;let i=this.getFrameData(t,e),s=i.coordinates.length/3,o=new l.yGw,n=new l.Vector3(1.5,1.5,1.5);s>800?n.setScalar(.75):s>600?n.setScalar(.75):s>400&&n.setScalar(1);for(let t=0;t<s;t++){let e=3*t,s=new l.Vector3(i.coordinates[e],i.coordinates[e+1],i.coordinates[e+2]);o.compose(s,new l._fP,n),this.setMatrixAt(t,o),this.setColorAt(t,new l.Ilk(i.colors[t]))}this.instanceMatrix.needsUpdate=!0,this.instanceColor.needsUpdate=!0,this.count=s}setTime(t){this.setNormalizedTime(t/this.getAnimationLength()%1)}getAnimationLength(){return this.rawFrames.length/this.fps}getFrameData(t,e){let i=this.rawFrames.length-1,s=Math.floor(t*i),o=s+1;s===i&&(o=e?s:0);let n=t*i-s,r=this.rawFrames[s],a=this.rawFrames[o],h=this.frameColors[s],m=this.frameColors[o],d=r.length/3,c=new Float32Array(r.length),u=Array(d);for(let t=0;t<r.length;t++)c[t]=r[t]+(a[t]-r[t])*n;for(let t=0;t<d;t++){let e=new l.Ilk(h[t]),i=new l.Ilk(m[t]);u[t]="#"+e.lerp(i,n).getHexString()}return{coordinates:c,colors:u}}restoreOriginalAnimation(){this.rawFrames=this.originalRawFrames.map(t=>new Float32Array(t)),this.frameColors=this.originalFrameColors.map(t=>[...t])}showBoundingBoxHelper(t){this.boundingBoxHelper.visible=t}dispose(){this.geometry.dispose(),this.material.dispose(),this.boundingBoxHelper.geometry.dispose(),this.boundingBoxHelper.material.dispose()}constructor(){super(new l.xo$(1),new l.vBJ,1e4),this.count=0,this.boundingBox=new l.ZzF,this.rawFrames=[],this.frameColors=[],this.originalRawFrames=[],this.originalFrameColors=[],this.layers.enable(5),this.fps=24,this.boundingBoxHelper=new l.GQ(this.boundingBox,65280),this.add(this.boundingBoxHelper)}}var m=i(28652),d=i(41313),c=i(60826),u=i(99351),f=i(54597),p=i(30966);class g{update(t){!1===this.firstUpdateElapsed&&(this.firstUpdateElapsed=!0,this.firstUpdateDelay=t/1e3),this.timeline.update(t/1e3-this.firstUpdateDelay),this.timelineViewer.update(),this.controls.update(),this.animatedPointCloud.setTime(this.timeline.animationTime),this.renderer.render(!0),this.lastElapsedTime=t,this.currentFrameID=requestAnimationFrame(this.update.bind(this))}setBloomStrength(t){this.renderer.setBloomStrength(t)}dispose(){cancelAnimationFrame(this.currentFrameID),this.renderer.dispose()}displayFormationBoundingBoxes(t){this.timelineViewer.displayFormationBoundingBoxes(t)}displayGrid(t){this.axisHelper.visible=t,this.gridHelper.visible=t}displayEnvironmentPOV(t){this.environment.visible=t,this.environment.visible?(this.controls.target.copy(this.environment.position).add(new l.Vector3(0,2,0)),this.camera.position.copy(this.controls.target).add(new l.Vector3(.1,0,0)),this.camera.fov=75,this.camera.far=300):(this.controls.target.set(0,0,0),this.camera.position.set(200,0,0),this.camera.far=3e3,this.camera.fov=60)}constructor(t){this.lastElapsedTime=0,this.axisHelper=new l.y8_(20),this.axisHelper.position.y=-40,this.axisHelper.layers.enable(3),this.gridHelper=new l.VLJ(200,20),this.gridHelper.renderOrder=-1,this.gridHelper.material.depthWrite=!1,this.gridHelper.position.y=-40,this.gridHelper.layers.enable(3),this.displayGrid(!1),this.timeline=new d.T,this.animatedPointCloud=new h,this.animatedPointCloud.showBoundingBoxHelper(!1),this.formationContainer=new c.Z,this.timelineViewer=new u.c(this.formationContainer,this.timeline),this.camera=new l.cPb(60,1,1,3e3),this.camera.position.x=200,this.scene=new l.xsS,this.scene.add(this.axisHelper),this.scene.add(this.gridHelper),this.scene.add(this.formationContainer),this.scene.add(this.animatedPointCloud),this.renderer=new f.T(this.scene,this.camera,t),this.currentFrameID=requestAnimationFrame(this.update.bind(this)),this.controls=new m.z(this.camera,this.renderer.getCanvas()),this.firstUpdateElapsed=!1,this.firstUpdateDelay=0,this.renderer.resizeIfNeeded(),this.environment=new p.q,this.scene.add(this.environment),this.displayEnvironmentPOV(!1),this.setBloomStrength(1)}}var x=function(t){let{viewerSize:e,setVisualizerInParent:i,widthFromParent:r,isPaused:l,setActiveFrameInParent:h,isFormation2D:m,framesDataFromParent:d,windowSize:c,isLoggedIn:u,mobileBreakpoint:f,leftNavBarWidth:p,speedFactorFromParent:x}=t,F=(0,o.useRef)(null),[w,_]=(0,o.useState)(null),[y,S]=(0,o.useState)(!1),[v,C]=(0,o.useState)(null),[A,b]=(0,o.useState)(null),[D,M]=(0,o.useState)(null),[z,B]=(0,o.useState)(null),[T,P]=(0,o.useState)(!1),[L,I]=(0,o.useState)(2);return(0,o.useEffect)(()=>{_({total_number_of_frames:d.total_number_of_frames,full_formation_coordinates:d.full_formation_coordinates})},[]),(0,o.useEffect)(()=>{if(!w)return;let t=new g(F.current);return t.animatedPointCloud.setAnimationData(w.full_formation_coordinates,m),t.setBloomStrength(L),i(t),t.timeline.setTime(0),void 0!=x&&(t.timeline.timeScale=x),()=>{t.dispose()}},[w,y,A,D,L]),(0,s.jsxs)("div",{className:a().standardCenteredDiv,style:{position:"relative",fontFamily:"Work Sans, sans-serif"},children:[(0,s.jsx)("button",{onClick:()=>P(!T),style:{position:"absolute",top:"10px",right:"10px",zIndex:10,background:"rgba(0,0,0,0.5)",color:"white",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontFamily:"Work Sans, sans-serif"},children:(0,s.jsx)(n.j,{size:24})}),T&&(0,s.jsxs)("div",{style:{position:"absolute",top:"60px",right:"10px",background:"rgba(0,0,0,0.8)",color:"white",borderRadius:"10px",padding:"15px",zIndex:10,width:"250px",fontFamily:"Work Sans, sans-serif"},children:[(0,s.jsx)("h4",{style:{margin:"0 0 15px 0",textAlign:"center",fontWeight:"600"},children:"Drone Glow"}),(0,s.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:(0,s.jsx)("input",{type:"range",min:"0.1",max:"4",step:"0.1",value:L,onChange:t=>{I(parseFloat(t.target.value))},style:{width:"100%",appearance:"none",background:"rgba(255,255,255,0.2)",height:"6px",borderRadius:"3px",outline:"none",opacity:.7,transition:"opacity .2s"}})}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8em",marginTop:"5px"},children:[(0,s.jsx)("span",{children:"Low"}),(0,s.jsx)("span",{children:"Medium"}),(0,s.jsx)("span",{children:"High"})]}),(0,s.jsx)("button",{onClick:()=>P(!1),style:{width:"100%",marginTop:"10px",background:"rgba(255,255,255,0.2)",color:"white",border:"none",borderRadius:"5px",padding:"5px",fontFamily:"Work Sans, sans-serif"},children:"Close"})]}),(0,s.jsx)("div",{ref:F,id:"myContainer",style:{width:e,height:e,borderRadius:"20px"}})]})}},10188:function(t,e,i){i.d(e,{h:function(){return n}});var s=i(50189);let o=t=>t.map(t=>({z:parseFloat(t.z).toFixed(3),x:parseFloat(t.x).toFixed(3),y:parseFloat(t.y).toFixed(3),color:t.color})),n=async t=>{try{let e;let i=await fetch(t);if(!i.ok)throw Error("HTTP error! status: ".concat(i.status));let n=await i.arrayBuffer(),r=new Uint8Array(n);try{e=s.ZP.ungzip(r)}catch(t){try{e=s.ZP.inflate(r)}catch(t){throw Error("Failed to decompress with both gzip and raw deflate methods")}}let a=new TextDecoder().decode(e),l=JSON.parse(a),h={};for(let t in l)h[t]={frame_number:l[t].frame_number,coordinates:o(l[t].coordinates)};return h}catch(t){throw console.error("Error in getFormationDataFromCompressedFileByUrl:",t),t}}}}]);