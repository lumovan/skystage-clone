"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9443],{89443:function(t,e,i){i.r(e);var s=i(52676),a=i(59668),o=i.n(a),n=i(75271),r=i(29824);i(63408),i(56620),i(66580),i(12113),i(2904),i(97592),i(78229);var d=i(33990),l=i(33726);i(62763);var h=i(4741),c=i(45031),p=i(48025);i(1608);var m=i(10188);i(33019);var x=i(30118),u=i(51494),f=i(95980),y=i(24499);class w extends n.Component{async componentDidMount(){let t=this.props.library;Intercom("update",{hide_default_launcher:!0}),setTimeout(()=>{this.handleGetLibraryInfoOnLoad(t)},100)}async componentWillUnmount(){Intercom("update",{hide_default_launcher:!1})}async handleTogglePlaybackSpeed(){"1x"==this.state.playbackSpeed?this.setState({playbackSpeed:"2x"}):"2x"==this.state.playbackSpeed?this.setState({playbackSpeed:"4x"}):"4x"==this.state.playbackSpeed?this.setState({playbackSpeed:"8x"}):this.setState({playbackSpeed:"1x"})}async handleGetLibraryInfoOnLoad(t){let e=await (0,l.RV)(t);this.setState({typesenseAPIKey:e.data.library.typesense_api_key,typesenseCollectionName:e.data.library.typesense_collection_name}),await this.handleGetAllFormationsFromLibraryList(e.data.library.typesense_api_key,e.data.library.typesense_collection_name),setTimeout(()=>{this.setState({selectedIndex:0})},100),setTimeout(()=>{this.fetchUpcomingAndPreviousFormation()},200)}async fetchUpcomingAndPreviousFormation(){var t=[];try{t.push(this.state.allFormations[this.state.selectedIndex].document.formation_uuid)}catch(t){}try{t.push(this.state.allFormations[this.state.selectedIndex+1].document.formation_uuid)}catch(t){}try{t.push(this.state.allFormations[this.state.selectedIndex+2].document.formation_uuid)}catch(t){}try{t.push(this.state.allFormations[this.state.selectedIndex+3].document.formation_uuid)}catch(t){}for(let e=0;e<t.length;e++)void 0==this.state.formationsCoordinatesObject[t[e]]&&this.handleGetCoordinatesFromFormationToQuery(t[e])}async deleteAllCoordinatesNotNeeded(){if(void 0!=this.state.allFormations[this.state.selectedIndex]){var t=[];try{t.push(this.state.allFormations[this.state.selectedIndex].document.formation_uuid)}catch(t){}try{t.push(this.state.allFormations[this.state.selectedIndex+1].document.formation_uuid)}catch(t){}try{t.push(this.state.allFormations[this.state.selectedIndex+2].document.formation_uuid)}catch(t){}try{t.push(this.state.allFormations[this.state.selectedIndex+3].document.formation_uuid)}catch(t){}for(var e=Object.keys(this.state.formationsCoordinatesObject),i=0;i<e.length;i++)-1==t.indexOf(e[i])&&this.handleDeleteCoordinatesFromObject(e[i])}}async handleDeleteCoordinatesFromObject(t){var e=this.state.formationsCoordinatesObject;delete e[t],this.setState({formationsCoordinatesObject:e})}async handleGetCoordinatesFromFormationToQuery(t){let e=await (0,f.V)(t);if(e.data&&e.data.did_work){let s;console.log("responseFromGetS3DownloadLink",e),this.setState({formationLengthInSeconds:Number(e.data.data.length_in_seconds)});let a="regular"===e.data.format_type?await (0,m.h)(e.data.presigned_url):await getFloat32DecompressedFormationDataFromUrl(e.data.presigned_url);a&&"binary"===a.format&&Array.isArray(a.frames)&&a.frames.length>0&&a.frames[0]instanceof Float32Array&&Array.isArray(a.colors)&&"number"==typeof a.droneCount?(console.log("coord_data is float 32 array format"),(s=Object.fromEntries(a.frames.map((t,e)=>[e,{coordinatesArray:t,colorsArray:a.colors[e]}]))).droneCount=a.droneCount):s=(0,y.o)(a);let o={total_number_of_frames:Object.keys(s).length,full_formation_coordinates:s};var i=this.state.formationsCoordinatesObject;i[t]={total_number_of_frames:o.total_number_of_frames,full_formation_coordinates:o.full_formation_coordinates},this.setState({formationsCoordinatesObject:i})}this.setState({formationsCoordinatesObject:i})}async handleGetAllFormationsFromLibraryList(t,e){var i=Array.from(new Set((await (0,h.n)(t,e)).data.hits.map(JSON.stringify))).map(JSON.parse),s=await function(t){let e=[...t];for(let t=e.length-1;t>0;t--){let i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}(i);console.log(s," loading this shuffled array "),await this.setState({allFormations:s}),this.handleGetCoordinatesFromFormationToQuery(s[0].document.formation_uuid)}async handleGoToNextFormation(){await this.setState({isViewerHidden:!0}),this.state.selectedIndex+1>=this.state.allFormations.length?await this.setState({selectedIndex:0}):await this.setState({selectedIndex:this.state.selectedIndex+1}),this.setState({isViewerHidden:!1}),this.fetchUpcomingAndPreviousFormation(),this.deleteAllCoordinatesNotNeeded()}async handleGoToPrevFormation(){await this.setState({isViewerHidden:!0}),0==this.state.selectedIndex?await this.setState({selectedIndex:this.state.allFormations.length-1}):await this.setState({selectedIndex:this.state.selectedIndex-1}),this.setState({isViewerHidden:!1}),this.fetchUpcomingAndPreviousFormation(),this.deleteAllCoordinatesNotNeeded()}render(){var t=this.props.mobileBreakpoint,e=this.props.windowSize.width<t;return(0,s.jsx)("div",{style:{backgroundColor:"black",height:this.props.sizeFromParent},children:(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",alignContent:"center",justifyContent:"center",width:"auto",position:"relative",backgroundColor:"black"},children:(0,s.jsxs)("div",{style:{width:"100%",paddingLeft:!0==e?"4vw":"10vw",paddingRight:!0==e?"4vw":"10vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflowX:"hidden"},children:[(0,s.jsxs)("div",{className:o().standardCenteredDiv,style:{width:"100%",marginTop:this.props.windowSize.width>this.props.mobileBreakpoint?"50px":"30px"},children:[(0,s.jsx)("div",{className:o().standardCenteredDiv,style:{width:this.props.windowSize.width,border:"0px solid red"},children:this.state.isViewerHidden?null:void 0==this.state.allFormations[this.state.selectedIndex]?null:void 0==this.state.allFormations[this.state.selectedIndex].document?null:void 0==this.state.allFormations[this.state.selectedIndex].document.title?null:(0,s.jsx)("text",{className:o().alternateTextBody,style:{zIndex:2,fontSize:this.props.windowSize.width>this.props.mobileBreakpoint?"25px":" 20px",fontWeight:"400",letterSpacing:"-.75px",textAlign:"center",paddingLeft:"30px",paddingRight:"30px",color:"white",letterSpacing:"-.75px"},children:this.state.allFormations[this.state.selectedIndex].document.title})}),(0,s.jsx)("div",{style:{height:"5px"}}),(0,s.jsxs)("div",{className:o().standardCenteredDiv,style:{flexDirection:"row",marginLeft:"-25px"},children:[this.state.isViewerHidden?null:void 0==this.state.allFormations[this.state.selectedIndex]?null:void 0==this.state.allFormations[this.state.selectedIndex].document?null:void 0==this.state.allFormations[this.state.selectedIndex].document.title?null:(0,s.jsx)("text",{onClick:()=>{this.state.formationsCoordinatesObject[this.state.selectedFormationUUID].completeCoordinatesObject.full_formation_coordinates},className:o().alternateTextBody,style:{zIndex:2,fontSize:this.props.windowSize.width>this.props.mobileBreakpoint?"16px":" 15px",fontWeight:"400",letterSpacing:"-.75px",textAlign:"center",paddingLeft:"30px",color:"white",letterSpacing:"-.75px"},children:this.state.allFormations[this.state.selectedIndex].document.num_drones}),(0,s.jsx)("div",{style:{width:"5px"}}),(0,s.jsx)("div",{style:{marginBottom:"-3.5px",zIndex:3},children:(0,s.jsx)(c.j,{size:15,color:"#fff"})}),(0,s.jsx)("div",{style:{width:"10px"}}),this.state.isViewerHidden?null:void 0==this.state.allFormations[this.state.selectedIndex]?null:void 0==this.state.allFormations[this.state.selectedIndex].document?null:void 0==this.state.allFormations[this.state.selectedIndex].document.title?null:(0,s.jsxs)("text",{className:o().alternateTextBody,style:{zIndex:2,fontSize:this.props.windowSize.width>this.props.mobileBreakpoint?"16px":" 16px",letterSpacing:"-.75px",fontWeight:"400",textAlign:"center",paddingLeft:"30px",color:"white",letterSpacing:"-.75px"},children:[this.state.allFormations[this.state.selectedIndex].document.length_in_seconds,"  "]}),(0,s.jsx)("div",{style:{width:"5px"}}),(0,s.jsx)("div",{style:{marginBottom:"-3.5px",zIndex:3},children:(0,s.jsx)(p.S,{size:15,color:"#fff"})})]}),(0,s.jsx)("div",{style:{minHeight:"15px"}}),(0,s.jsx)("div",{className:o().standardCenteredDiv,style:{flexDirection:"row"}}),this.state.isViewerHidden||void 0==this.state.allFormations[this.state.selectedIndex]||void 0==this.state.allFormations[this.state.selectedIndex].document||void 0==this.state.allFormations[this.state.selectedIndex].document.formation_uuid||void 0==this.state.formationsCoordinatesObject||void 0==this.state.formationsCoordinatesObject[[this.state.allFormations[this.state.selectedIndex].document.formation_uuid]]||void 0==this.state.formationsCoordinatesObject[[this.state.allFormations[this.state.selectedIndex].document.formation_uuid]].full_formation_coordinates?(0,s.jsxs)("div",{className:o().standardCenteredDiv,style:{width:this.props.windowSize.width<this.props.mobileBreakpoint?this.props.windowSize.width+"px":"800px",height:this.props.windowSize.width<this.props.mobileBreakpoint?this.props.windowSize.width/2+"px":"400px",marginTop:"-30px"},children:[(0,s.jsx)("text",{className:o().alternateTextBody,style:{fontSize:"15px",color:"white"},children:"Loading 3d preview"}),(0,s.jsx)(x.Z,{})]}):(0,s.jsx)("div",{style:{marginTop:this.props.windowSize.width<this.props.mobileBreakpoint?"0px":"-100px",zIndex:1},children:(0,s.jsx)(u.Z,{isInComponent:!0,framesData:this.state.formationsCoordinatesObject[[this.state.allFormations[this.state.selectedIndex].document.formation_uuid]],windowSize:this.props.windowSize,viewerSize:this.props.windowSize.width<this.props.mobileBreakpoint?this.props.windowSize.width+"px":this.props.sizeFromParent,isDraftCoordinates:!1,areControlsHidden:!0,areLibraryCarouselControlsVisible:!0,zIndexForButtons:this.props.zIndexForButtons,isPlayingByDefault:!0,updateIsPlayingByDefault:()=>{},handleTogglePlaybackSpeed:()=>this.handleTogglePlaybackSpeed(),playbackSpeed:this.state.playbackSpeed})}),(0,s.jsx)("div",{style:{minHeight:"50px"}})]}),(0,s.jsxs)("div",{className:o().standardCenteredDiv,style:{position:"relative",flexDirection:"row",bottom:120,zIndex:void 0==this.props.zIndexForButtons?3:this.props.zIndexForButtons},children:[(0,s.jsx)(r.E.div,{className:o().standardCenteredDiv,onClick:()=>{this.handleGoToPrevFormation()},whileHover:{scale:1.05},whileTap:{scale:.95},style:{backgroundColor:"#333",cursor:"pointer",width:"65px",height:"25px",borderRadius:"7.5px"},children:(0,s.jsx)("text",{className:o().alternateTextBody,style:{cursor:"pointer",zIndex:2,fontSize:this.props.windowSize.width>this.props.mobileBreakpoint?"17px":" 17px",textAlign:"center",paddingLeft:"30px",paddingRight:"30px",color:"white",letterSpacing:"-.75px"},children:"←"})}),(0,s.jsx)("div",{style:{width:"50px"}}),(0,s.jsx)(r.E.div,{className:o().standardCenteredDiv,onClick:()=>{this.handleGoToNextFormation()},whileHover:{scale:1.05},whileTap:{scale:.95},style:{backgroundColor:"#333",cursor:"pointer",width:"65px",height:"25px",borderRadius:"7.5px"},children:(0,s.jsx)("text",{className:o().alternateTextBody,style:{cursor:"pointer",zIndex:2,fontSize:this.props.windowSize.width>this.props.mobileBreakpoint?"17px":" 17px",textAlign:"center",paddingLeft:"30px",paddingRight:"30px",color:"white",letterSpacing:"-.75px"},children:"→"})})]}),(0,s.jsx)("div",{style:{minHeight:"10px"}})]})})})}constructor(){super(),this.state={allFormations:[],formationsCoordinatesObject:{},playbackSpeed:"1x"}}}e.default=(0,d.withRouter)(w)}}]);